{"version":3,"sources":["hooks/accounts/queries/useGetAccountsQuery.tsx","hooks/accounts/usePersistActiveAccount.tsx","hooks/accounts/resolvers/useSetActiveAccountMutationResolver.tsx","hooks/accounts/useSetActiveAccount.tsx","hooks/accounts/resolvers/useAccountsMutationResolvers.tsx","hooks/polkadotJs/typesConfig.tsx","hooks/config/usePersistentConfig.tsx","hooks/polkadotJs/usePolkadotJs.tsx","hooks/balances/useGetBalancesByAddress.tsx","hooks/balances/useBalanceQueryResolvers.tsx","hooks/vesting/useGetVestingScheduleByAddress.tsx","hooks/vesting/useVestingScheduleQueryResolvers.tsx","hooks/accounts/useGetAccounts.tsx","hooks/accounts/resolvers/useGetAccountsQueryResolver.tsx","hooks/lastBlock/useLastBlockQuery.tsx","hooks/lastBlock/useSubscribeNewBlockNumber.tsx","hooks/lastBlock/useRefetchWithNewBlock.tsx","hooks/accounts/queries/useGetActiveAccountQuery.tsx","hooks/vesting/useVestingMutationResolvers.tsx","hooks/balances/useBalanceMutationResolvers.tsx","hooks/polkadotJs/useExtensionQueryResolvers.tsx","hooks/config/useConfigQueryResolvers.tsx","hooks/config/useConfigMutationResolver.tsx","hooks/feePaymentAssets/useFeePaymentAssetsQueryResolvers.tsx","hooks/math/useMath.tsx","hooks/pools/useGetXykPools.tsx","hooks/pools/lbp/calculateOppositeAssetWeight.tsx","hooks/pools/lbp/calculateCurrentAssetWeight.tsx","hooks/lastBlock/readLastBlock.tsx","hooks/pools/useGetLbpPools.tsx","hooks/pools/useGetLbpPool.tsx","hooks/pools/resolvers/useGetPoolsQueryResolver.tsx","hooks/pools/useGetXykPool.tsx","hooks/assets/resolvers/useGetAssetsQueryResolver.tsx","hooks/assets/useGetAssets.tsx","components/Chart/shared.tsx","generated/graphql.tsx","hooks/accounts/readActiveAccount.tsx","hooks/pools/lbp/buy.tsx","hooks/pools/lbp/sell.tsx","hooks/pools/xyk/buy.tsx","hooks/pools/xyk/sell.tsx","hooks/pools/resolvers/usePoolsMutationResolvers.tsx","hooks/pools/resolvers/useSubmitTradeMutationResolvers.tsx","hooks/apollo/useApollo.tsx","hooks/accounts/resolvers/useAccountsQueryResolvers.tsx","hooks/pools/resolvers/usePoolsQueryResolver.tsx","hooks/assets/resolvers/useAssetsQueryResolvers.tsx","hooks/polkadotJs/useGetExtensionQuery.tsx","containers/MultiProvider.tsx","hooks/pools/queries/useGetPoolByAssetsQuery.tsx","components/Input/TokenInput.tsx","hooks/math/useFromPrecision.tsx","hooks/math/useToPrecision.tsx","containers/TradeForm/hooks/useTradeForm.tsx","containers/TradeForm/hooks/useListenForInput.tsx","hooks/pools/mutations/useSubmitTradeMutation.tsx","containers/TradeForm/hooks/useHandleSubmit.tsx","hooks/pools/xyk/calculateOutGivenIn.tsx","hooks/pools/lbp/calculateInGivenOut.tsx","hooks/pools/lbp/calculateOutGivenIn.tsx","hooks/pools/xyk/calculateInGivenOut.tsx","hooks/pools/poolHasAssets.tsx","hooks/math/usePercentageChange.tsx","containers/TradeForm/hooks/useSlippage.tsx","constants.tsx","containers/TradeForm/hooks/usePercentageFee.tsx","containers/TradeForm/hooks/useCalculateAllowedSlippage.tsx","containers/TradeForm/TradeForm.tsx","containers/TradeForm/hooks/useTradeType.tsx","containers/TradeForm/hooks/useHandleAssetIdsChange.tsx","containers/TradeForm/hooks/useCalculateInAndOut.tsx","containers/TradeForm/hooks/useResetAmountInputsOnPoolChange.tsx","containers/TradeChart.tsx","hooks/pools/lbp/calculateSpotPrice.tsx","hooks/pools/xyk/calculateSpotPrice.tsx","pages/TradePage/TradePage.tsx","pages/TradePage/hooks/useSpotPrice.tsx","hooks/accounts/mutations/useSetActiveAccountMutation.tsx","pages/WalletPage.tsx","containers/Router.tsx","components/Navigation/ActionBar.tsx","components/Navigation/Navigation.tsx","components/Balance/metricUnit.tsx","components/Balance/FormattedBalance/FormattedBalance.tsx","components/Balance/FormattedBalance/hooks/useFormatSI.tsx","components/Icon/svg/HelpIcon.svg","components/Icon/svg/NotificationActiveIcon.svg","components/Icon/svg/NotificationInactiveIcon.svg","components/Icon/svg/DropdownArrowIcon.svg","components/Icon/Icon.tsx","components/Wallet/AccountSelector/AccountItem/AccountItem.tsx","components/Button/Button.tsx","components/Wallet/AccountSelector/AccountSelector.tsx","components/Wallet/Wallet.tsx","components/Wallet/AccountSelector/hooks/useModalPortalElement.tsx","components/Balance/AssetBalanceInput/hooks/useModalPortal.tsx","containers/Wallet.tsx","containers/TopBar.tsx","containers/PageContainer.tsx","hooks/misc/useLoading.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["GET_ACCOUNTS","useGetAccountsQuery","useQuery","notifyOnNetworkStatusChange","defaultValue","id","undefined","usePersistedActiveAccount","createPersistedState","usePersistActiveAccount","useSetActiveAccountMutationResolver","setActiveAccount","setPersistedActiveAccount","useCallback","async","client","address","accountsData","cache","readQuery","query","accounts","map","account","isActive","activeAccount","find","forEach","modify","identify","__typename","fields","_","Promise","resolve","setTimeout","useSetActiveAccount","useResolverToRef","_obj","args","resolver","name","resolverRef","useRef","useEffect","current","log","debug","apply","arguments","defaultConfigValue","nodeUrl","process","processorUrl","appName","usePersistedConfig","usePersistentConfig","getPoolAccount","description","params","type","rpc","xyk","lbp","PolkadotJsProvider","usePolkadotJsContext","constate","apiInstance","setApiInstance","useState","loading","useMemo","provider","WsProvider","types","typesConfig","ormlTypes","typesAlias","ormlTypesAlias","api","ApiPromise","create","isReady","disconnect","nativeAssetId","useGetBalancesByAddress","assetIds","balances","includes","nativeAssetBalance","system","push","assetId","balance","data","free","toString","assetBalances","filter","e","tokens","multi","codec","i","entries","storageKey","toHuman","assetBalance","createType","getBalancesByAddress","useBalanceQueryResolvers","entity","assetInId","assetOutId","balanceLockDataType","getLockedBalanceByAddressAndLockId","lockId","lockedNativeBalance","locks","lockedAmount","eq","tokenBalanceLocks","_storageKey","tokenBalanceLock","toJSON","amount","lockedTokensBalance","useVestingScheduleQueryResolvers","getVestingScheduleByAddress","vestingSchedule","first","vesting","vestingSchedules","lockedVestingAmount","remainingVestingAmount","start","period","periodCount","perPeriod","useGetVestingScheduleByAddress","useGetAccountsQueryResolver","persistedActiveAccount","getAccounts","persistedActiveAccountId","web3Enable","web3Accounts","encodeAddress","decodeAddress","meta","isArray","GET_LAST_BLOCK","LastBlockProvider","useLastBlockContext","lastBlock","setLastBlock","subscribeNewBlocks","derive","chain","validationData","parachainSystem","validationDataOption","isSome","parachainBlockNumber","block","header","number","relaychainBlockNumber","writeLastBlock","writeQuery","GET_ACTIVE_ACCOUNT","useGetActiveAccountQuery","useApolloClient","result","refetchQueries","GetActiveAccountQueryProvider","useGetActiveAccountQueryContext","withGracefulErrors","fn","errorHandlers","reject","console","reduce","errorHandler","gracefulExtensionCancelationErrorHandler","message","error","vestingClaimHandler","status","events","dispatchError","isFinalized","info","event","method","section","phase","isInBlock","createdAtHash","isModule","registry","findMetaError","asModule","isBroadcast","hash","polkadotJsNotReadyYetError","useVestingMutationResolvers","claimVestedAmount","variables","Error","signer","web3FromAddress","tx","claim","signAndSend","transferBalanceExtrinsic","currencies","transfer","useBalanceMutationResolvers","transferBalance","from","to","currencyId","transferBalanceHandler","useConfigQueryResolvers","persistedConfig","config","_variables","feePaymentAsset","multiTransactionPayment","accountCurrencyMap","useConfigMutationResolvers","_persistedConfig","setPersistedConfig","setConfig","setCurrency","setCurrencyHandler","persistableConfig","useFeePaymentAssetsQueryResolvers","feePaymentAssets","acceptedCurrencies","acceptedCurrency","fallbackPrice","loadMath","MathProvider","useMathContext","wasm","setWasm","instance","math","mapToPoolId","hundredWithPrecision6","BigNumber","multipliedBy","pow","calculateOppositeAssetWeight","weight","minus","toFixed","calculateCurrentAssetWeight","pool","weights","calculate_linear_weights","startBlock","endBlock","initial","final","readLastBlock","repayFee","numerator","denominator","mapToPool","poolData","lastBlockData","feeCollector","repayTarget","partialPool","assets","end","partialAssetAWeights","initialWeight","finalWeight","assetAWeights","assetBWeights","feeCollectorBalanceLockAmount","repayTargetReached","gt","poolFee","fee","useGetLbpPools","all","getLbpPools","useGetLbpPool","poolId","getLbpPool","useGetPoolsQueryResolver","getXykPools","poolAssets","useGetXykPools","getXykPool","useGetXykPool","context","poolIds","lbpPoolId","xykPoolId","getPoolIdsByAssetIds","lbpPool","xykPool","lbpPools","xykPools","concat","useGetAssetsQueryResolver","getAssets","assetRegistry","mapToAsset","useGetAssets","asset","ChartGranularity","ChartType","PoolType","TradeType","readActiveAccount","returnPartialData","buy","assetBuy","assetSell","amountBuy","maxSold","buyHandler","sell","amountSell","minBought","sellHandler","xykBuyHandler","usePoolsMutationResolvers","submitTrade","poolType","XYK","tradeType","Buy","buyXyk","assetOutAmount","amountWithSlippage","Sell","sellXyk","assetInAmount","LBP","buyLbp","sellLbp","useSubmitTradeMutationResolver","useResolvers","Query","AccountsQueryResolver","Account","PoolsQueryResolver","XYKPool","LBPPool","getPoolsQueryResolver","poolFieldsQueryResolvers","pools","usePoolsQueryResolver","extension","extensions","isAvailable","length","Mutation","typeDefs","useConfigureApolloClient","resolvers","InMemoryCache","ApolloClient","uri","connectToDevTools","queryDeduplication","updateCache","useRefetchWithNewBlock","GET_EXTENSION","useGetExtensionQuery","GetExtensionQueryProvider","useContextualGetExtensionLazyQuery","useLazyQuery","ConfiguredApolloProvider","children","ApolloProvider","QueryProvider","MultiProvider","GET_POOL_BY_ASSETS","TokenInput","assetIdInputProps","assetAmountInputProps","disabled","precision12","fromPrecision12","dividedBy","toPrecision12","useListenForInput","form","field","state","setState","inputRef","control","_fields","_f","ref","listener","addEventListener","removeEventListener","SUBMIT_TRADE","useHandleSubmit","allowedSlippage","slippage","useMutation","spotPriceAmount","slippageAmount","amountBN","plus","applyAllowedSlippage","calculateOutGivenInFromPool","amountIn","assetInBalance","assetOutBalance","inReserve","outReserve","calculate_out_given_in","calculateOutGivenIn","getPoolBalances","assetABalance","assetBBalance","getInAndOutWeights","assetInWeight","assetOutWeight","calculateInGivenOutFromPool","amountOut","inWeight","outWeight","calculate_in_given_out","calculateInGivenOut","poolHasAssets","percentageChange","a","b","aBN","calculateSlippage","spotPrice","resultPercentageChange","isNaN","ROUNDING_MODE","ROUND_UP","percentualSlippage","abs","useSlippage","aToB","bToA","xykFee","feeToPercentage","feeFromPool","constants","defaultAllowedSlippage","useCalculateAllowedSlippage","watchAutoSlippage","watch","allowedSlippageInputDisabled","getValues","allowedSlippageWithFee","setValue","TradeForm","onAssetIdsChange","useForm","defaultValues","autoSlippage","useTradeForm","usePercentageFee","setTradeType","watchassetInAmount","watchAassetInId","watchAassetOutAmount","watchAassetOutId","useTradeType","useHandleAssetIdsChange","calculateOutGivenInFromPoolXYK","calculateOutGivenInFromPoolLBP","calculateInGivenOutFromPoolXYK","calculateInGivenOutFromPoolLBP","outAmount","inAmount","useCalculateInAndOut","previousPoolId","usePreviousDistinct","isEqual","resetField","useResetAmountInputsOnPoolChange","handleSubmit","onSubmit","register","TradeChart","poolLiquidity","oneWithPrecision","calculateSpotPriceFromPool","get_spot_price","calculateSpotPrice","TradePage","setAssetIds","poolLoading","poolError","calculateSpotPriceFromPoolXYK","calculateSpotPriceFromPoolLBP","useSpotPrice","newIds","SET_ACTIVE_ACCOUNT","useSetActiveAccountMutation","unsetActiveAccount","style","marginBottom","padding","paddingLeft","onClick","WalletPage","accountsLoading","extensionData","extensionLoading","textAlign","Router","path","element","ActionBar","activeAccountLoading","accountData","isExtensionAvailable","className","Navigation","UnitStyle","MetricUnit","unitMap","assetIdNameMap","SI_PREFIXES","prefixes","prefix","metricPrefix","base10","symbol","fullName","FormattedBalance","precision","unitStyle","LONG","assetSymbol","formattedBalance","balanceWithPrecision12","siFormat","formatFixedSI","unitName","unit","numberOfDecimalPlaces","value","split","suffix","displayUnit","useFormatSI","toLowerCase","_path","_extends","Object","assign","target","source","key","prototype","hasOwnProperty","call","this","SvgHelpIcon","_ref","svgRef","title","titleId","props","width","height","viewBox","fill","xmlns","d","ForwardRef","_circle","SvgNotificationActiveIcon","fillRule","clipRule","cx","cy","r","SvgNotificationInactiveIcon","SvgDropdownArrowIcon","IconType","Icon","HELP","NOTIFICATION_ACTIVE","NOTIFICATION_INACTIVE","DROPDOWN_ARROW","AccountItem","active","classNames","SHORT","size","theme","ButtonKind","Button","kind","Primary","Secondary","AccountSelector","onAccountSelected","innerRef","closeModal","href","Wallet","modalContainerRef","modalPortalElement","handleAccountSelected","elementRef","isModalOpen","useModalPortalElement","toggleModal","modalPortal","toggleId","elementFactory","container","closeOnClickOutside","setModalPortal","setIsModalOpen","openModal","uuidv4","createPortal","useOnClickOutside","didClickOutsideToggle","closest","useModalPortal","handleAccountSelectorClick","TopBar","activeAccountData","PageContainer","useLoading","margin","setLevel","branch","baseName","App","basename","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.1a8a625e.chunk.js","sourcesContent":["import { useQuery } from '@apollo/client'\nimport { Query } from '../../../generated/graphql';\nimport { loader } from 'graphql.macro';\n\nexport const GET_ACCOUNTS = loader('./../graphql/GetAccounts.query.graphql');\nexport interface GetAccountsQueryResponse {\n    accounts: Query['accounts'],\n    lastBlock: Query['lastBlock']\n}\n\nexport const useGetAccountsQuery = () => useQuery<GetAccountsQueryResponse>(GET_ACCOUNTS, {\n    notifyOnNetworkStatusChange: true,\n});","import createPersistedState from 'use-persisted-state';\n\nexport const key = 'basilisk-active-account';\nexport const defaultValue = {\n  id: undefined,\n};\nexport interface PersistedAccount {\n  id: string | undefined;\n}\n\n// we're not using react-use/useLocalStorage since i couldn't figure out\n// why it would not trigger effects when the local storage updates\nconst usePersistedActiveAccount = createPersistedState(key);\nexport const usePersistActiveAccount = () =>\n  usePersistedActiveAccount<PersistedAccount | undefined>(defaultValue);\n","import { ApolloClient, NormalizedCacheObject } from '@apollo/client';\nimport { useCallback } from 'react';\nimport { useSetActiveAccount } from '../useSetActiveAccount';\nimport { SetActiveAccountMutationVariables } from '../mutations/useSetActiveAccountMutation';\nimport { useResolverToRef } from './useAccountsMutationResolvers';\n\nexport const useSetActiveAccountMutationResolver = () => {\n  const setActiveAccount = useSetActiveAccount();\n\n  return useResolverToRef(\n    useCallback(\n      async (\n        _obj,\n        args: SetActiveAccountMutationVariables,\n        { client }: { client: ApolloClient<NormalizedCacheObject> }\n      ) => setActiveAccount(client, args.id),\n      [setActiveAccount]\n    ),\n    'setActiveAccount'\n  );\n};\n","import { ApolloClient, NormalizedCacheObject } from '@apollo/client';\nimport { find } from 'lodash';\nimport { useCallback } from 'react';\nimport {\n  GetAccountsQueryResponse,\n  GET_ACCOUNTS,\n} from './queries/useGetAccountsQuery';\nimport { usePersistActiveAccount } from './usePersistActiveAccount';\n\nexport const useSetActiveAccount = () => {\n  const [, setPersistedActiveAccount] = usePersistActiveAccount();\n\n  return useCallback(\n    async (\n      client: ApolloClient<NormalizedCacheObject>,\n      address: string | undefined\n    ) => {\n      const accountsData = client.cache?.readQuery<GetAccountsQueryResponse>({\n        query: GET_ACCOUNTS,\n      });\n\n      if (!accountsData?.accounts) return;\n\n      const accounts = accountsData.accounts.map((account) => ({\n        ...account,\n        isActive: account.id === address,\n      }));\n\n      const activeAccount = find(accounts, { isActive: true });\n      setPersistedActiveAccount({\n        id: activeAccount?.id,\n      });\n\n      // TODO: return the data to be mutated from the mutation instead\n      // client.cache?.writeQuery<GetAccountsQueryResponse>({\n      //     query: GET_ACCOUNTS,\n      //     data: { accounts, lastBlock: accountsData.lastBlock }\n      // });\n\n      accounts.forEach((account) => {\n        client.cache.modify({\n          id: client.cache.identify({\n            __typename: account.__typename,\n            id: account.id,\n          }),\n          fields: {\n            isActive: (_) => account.isActive,\n          },\n        });\n      });\n\n      // wait for the local storage changes before finishing the mutation\n      // TODO: find a better way to wait until the local storage changes are\n      // propagated to the resolverRef\n      await new Promise((resolve) => setTimeout(resolve, 0));\n\n      return accounts;\n    },\n    [setPersistedActiveAccount]\n  );\n};\n","import { Resolver } from '@apollo/client';\nimport { useEffect, useRef } from 'react';\nimport log from 'loglevel';\nimport { useSetActiveAccountMutationResolver } from './useSetActiveAccountMutationResolver';\n\n/**\n * Updates the resolver fn ref each time the given resolver fn changes.\n *\n * This is necessary to reflect changes made to functions within hooks\n * within the Apollo resolvers configuration.\n */\nexport const useResolverToRef = (resolver: Resolver, name?: string) => {\n  const resolverRef = useRef(resolver);\n  // when the resolver changes, update the ref\n  useEffect(() => {\n    resolverRef.current = resolver;\n  }, [resolver]);\n\n  return function resolverFromRef() {\n    // TODO is there a better way to debug resolvers? Since the function name\n    // is not visible in the apollo error\n    log.debug('Running resolver', name);\n    // execute the wrapper resolver ref, with the given arguments from Apollo\n    return resolverRef.current.apply(undefined, arguments as any);\n  };\n};\n\n/**\n * Used to resolve mutations regarding the Account entity\n * @returns\n */\nexport const useAccountsMutationResolvers = () => {\n  const setActiveAccountMutationResolver =\n    useSetActiveAccountMutationResolver();\n\n  return {\n    setActiveAccount: setActiveAccountMutationResolver,\n  };\n};\n","export default {\n    \"alias\": {\n      \"tokens\": {\n        \"AccountData\": \"OrmlAccountData\"\n      }\n    },\n    \"types\": [\n      {\n        \"AssetPair\": {\n          \"asset_in\": \"AssetId\",\n          \"asset_out\": \"AssetId\"\n        },\n        \"Amount\": \"i128\",\n        \"AmountOf\": \"Amount\",\n        \"Address\": \"AccountId\",\n        \"OrmlAccountData\": {\n          \"free\": \"Balance\",\n          \"frozen\": \"Balance\",\n          \"reserved\": \"Balance\"\n        },\n        \"Fee\": {\n          \"numerator\": \"u32\",\n          \"denominator\": \"u32\"\n        },\n        \"BalanceInfo\": {\n          \"amount\": \"Balance\",\n          \"assetId\": \"AssetId\"\n        },\n        \"Chain\": {\n          \"genesisHash\": \"Vec<u8>\",\n          \"lastBlockHash\": \"Vec<u8>\"\n        },\n        \"Currency\": \"AssetId\",\n        \"CurrencyId\": \"AssetId\",\n        \"CurrencyIdOf\": \"AssetId\",\n        \"Intention\": {\n          \"who\": \"AccountId\",\n          \"asset_sell\": \"AssetId\",\n          \"asset_buy\": \"AssetId\",\n          \"amount\": \"Balance\",\n          \"discount\": \"bool\",\n          \"sell_or_buy\": \"IntentionType\"\n        },\n        \"IntentionId\": \"Hash\",\n        \"IntentionType\": {\n          \"_enum\": [\n            \"SELL\",\n            \"BUY\"\n          ]\n        },\n        \"LookupSource\": \"AccountId\",\n        \"Price\": \"Balance\",\n        \"ClassId\": \"u64\",\n        \"TokenId\": \"u64\",\n        \"ClassData\": {\n          \"is_pool\": \"bool\"\n        },\n        \"TokenData\": {\n          \"locked\": \"bool\"\n        },\n        \"ClassInfo\": {\n          \"metadata\": \"Vec<u8>\",\n          \"total_issuance\": \"TokenId\",\n          \"owner\": \"AccountId\",\n          \"data\": \"ClassData\"\n        },\n        \"TokenInfo\": {\n          \"metadata\": \"Vec<u8>\",\n          \"owner\": \"AccountId\",\n          \"data\": \"TokenData\"\n        },\n        \"ClassInfoOf\": \"ClassInfo\",\n        \"TokenInfoOf\": \"TokenInfo\",\n        \"ClassIdOf\": \"ClassId\",\n        \"TokenIdOf\": \"TokenId\",\n        \"OrderedSet\": \"Vec<AssetId>\",\n        \"VestingSchedule\": {\n          \"start\": \"BlockNumber\",\n          \"period\": \"BlockNumber\",\n          \"period_count\": \"u32\",\n          \"per_period\": \"Compact<Balance>\"\n        },\n        \"VestingScheduleOf\": \"VestingSchedule\",\n        \"LBPWeight\": \"u32\",\n        \"WeightCurveType\": {\n          \"_enum\": [\n            \"Linear\"\n          ]\n        },\n        \"PoolId\": \"AccountId\",\n        \"BalanceOf\": \"Balance\",\n        \"AssetType\": {\n          \"_enum\": {\n            \"Token\": \"Null\",\n            \"PoolShare\": \"(AssetId,AssetId)\"\n          }\n        },\n        \"Pool\": {\n          \"owner\": \"AccountId\",\n          \"start\": \"BlockNumber\",\n          \"end\": \"BlockNumber\",\n          \"assets\": \"AssetPair\",\n          \"initial_weight\": \"LBPWeight\",\n          \"final_weight\": \"LBPWeight\",\n          \"weight_curve\": \"WeightCurveType\",\n          \"fee\": \"Fee\",\n          \"fee_collector\": \"AccountId\"\n        },\n        \"AssetDetails\": {\n          \"name\": \"Vec<u8>\",\n          \"asset_type\": \"AssetType\",\n          \"existential_deposit\": \"Balance\",\n          \"locked\": \"bool\"\n        },\n        \"AssetDetailsT\": \"AssetDetails\",\n        \"AssetMetadata\": {\n          \"symbol\": \"Vec<u8>\",\n          \"decimals\": \"u8\"\n        },\n        \"AssetInstance\": \"AssetInstanceV1\",\n        \"MultiLocation\": \"MultiLocationV1\",\n        \"AssetNativeLocation\": \"MultiLocation\",\n        \"MultiAsset\": \"MultiAssetV1\",\n        \"Xcm\": \"XcmV1\",\n        \"XcmOrder\": \"XcmOrderV1\"\n      }\n    ]\n  };","import createPersistedState from 'use-persisted-state';\nimport { Config } from '../../generated/graphql';\n\nconst key = 'basilisk-config';\nexport const defaultConfigValue = {\n    nodeUrl: process.env.REACT_APP_NODE_URL!,\n    processorUrl: process.env.REACT_APP_PROCESSOR_URL!,\n    appName: process.env.REACT_APP_APP_NAME!\n};\n\n// TODO: write apollo integration for querying and mutating the config\nconst usePersistedConfig = createPersistedState(key)\nexport const usePersistentConfig = () => usePersistedConfig<Config>(defaultConfigValue);","import { ApiPromise, WsProvider, HttpProvider } from '@polkadot/api';\nimport { ProviderInterface } from '@polkadot/rpc-provider/types'\nimport { useMemo, useState, useEffect } from 'react';\nimport constate from 'constate';\nimport typesConfig from './typesConfig';\nimport { usePersistentConfig } from '../config/usePersistentConfig';\nimport { types as ormlTypes, typesAlias as ormlTypesAlias } from '@open-web3/orml-type-definitions'\n\nconst getPoolAccount = {\n  description: 'Get pool account id by asset IDs',\n  params: [\n    {\n      name: 'assetInId',\n      type: 'u32'\n    },\n    {\n      name: 'assetOutId',\n      type: 'u32'\n    }\n  ],\n  type: 'AccountId'\n};\nconst rpc = {\n  xyk: {\n    getPoolAccount  \n  },\n  lbp: {\n    getPoolAccount\n  }\n}\n\n/**\n * Setup an instance of PolkadotJs, and watch\n * for config updates. In case the nodeUrl changes,\n * then re-create the PolkadotJs instance\n */\nexport const useConfigurePolkadotJs = () => {\n  const [{ nodeUrl }] = usePersistentConfig();\n  const [apiInstance, setApiInstance] = useState<ApiPromise | undefined>(undefined);\n  const loading = useMemo(() => apiInstance ? false : true, [apiInstance]);\n  const provider = useMemo(() => new WsProvider(nodeUrl), [nodeUrl]);\n\n  const types = useMemo(() => ({\n    ...typesConfig.types[0],\n    ...ormlTypes,\n  }), []);\n\n  const typesAlias = useMemo(() => ({\n    ...typesConfig.alias,\n    ...ormlTypesAlias\n  }), []);\n\n  // (re-)Create the PolkadotJS instance, when the provider updates.\n  useEffect(() => {\n    (async () => {\n      setApiInstance(undefined);\n      const api = await ApiPromise.create({\n        provider,\n        types,\n        typesAlias,\n        rpc\n      });\n      await api.isReady;\n      setApiInstance(api);\n    })();\n\n    // when the component using the usePolkadot hook unmounts, disconnect the websocket\n    return () => {\n      apiInstance?.disconnect();\n    };\n  }, [provider]);\n\n  return { apiInstance, loading };\n};\n\n// TODO: lift to context using constate\n// export const usePolkadotJs = () => useConfigurePolkadotJs();\nexport const [PolkadotJsProvider, usePolkadotJsContext] = constate(useConfigurePolkadotJs);","import { ApiPromise } from '@polkadot/api';\nimport { includes } from 'lodash';\nimport { useCallback } from 'react';\nimport { Balance } from '../../generated/graphql';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs';\n\nexport const nativeAssetId = '0';\nexport const assetBalanceDataType = 'AccountData';\n\nexport const getBalancesByAddress = async (\n    apiInstance: ApiPromise, \n    address: string, \n    assetIds?: string[]\n) => {\n    const balances: Balance[] = [];\n        \n    // fetch the native balance, only if no assetIds were specified, or if it was explicitly requested\n    if (!assetIds || includes(assetIds, nativeAssetId)) {\n        const nativeAssetBalance = await apiInstance.query.system.account(address);    \n\n        balances.push({\n            assetId: nativeAssetId,\n            balance: nativeAssetBalance?.data.free.toString()\n        });\n    }\n\n    // we've already fetched the native balance above, ignore it down the line\n    assetIds = assetIds ? assetIds.filter(e => e !== nativeAssetId) : assetIds;\n\n    // TODO: write type definitions for `query.tokens`\n    const assetBalances = assetIds\n        // if there are specific assetIds to fetch, query only those\n        ? (await apiInstance.query.tokens.accounts.multi(\n            // query for [address, assetId]\n            assetIds\n                ?.map((assetId) => [address, assetId])\n        ))\n            .map((codec, i) => ({\n                // pair the assetId in the same order as asked for in the multi query above\n                assetId: assetIds![i],\n                balance: codec\n            }))\n        // if no assetIds were specified, fetch all balances\n        : (await apiInstance.query.tokens.accounts.entries(address))\n            .map(([storageKey, codec]) => ({\n                assetId: (storageKey.toHuman() as string[])[1],\n                balance: codec\n            }))\n\n    assetBalances?.forEach(assetBalance => {\n        // only extracting the free balance as of now\n        const balance = apiInstance?.createType(\n            assetBalanceDataType,\n            assetBalance.balance\n        ).free.toString();\n\n        balances.push({ assetId: assetBalance.assetId, balance });\n    });\n\n    // TODO: treat Balance as a top level entity for caching purposes\n    return balances;\n}\n\nexport const useGetBalancesByAddress = () => {\n    const { apiInstance, loading } = usePolkadotJsContext()\n\n    return useCallback(async (address?: string, assetIds?: string[]) => {\n        if (!apiInstance || !address) return;\n        return await getBalancesByAddress(apiInstance, address, assetIds)\n    }, [apiInstance, loading]);\n}","import { useCallback } from 'react'\nimport { Account, LbpPool, XykPool } from '../../generated/graphql';\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\nimport { useGetBalancesByAddress } from './useGetBalancesByAddress';\n\nexport const __typename = 'Balance';\nexport const useBalanceQueryResolvers = () => {\n    const getBalancesByAddress = useGetBalancesByAddress();\n    const balances = useResolverToRef(\n        useCallback(\n            /**\n             * TODO: figure out how to use @export to fetch balances only for certain assetIds\n             * then we don't have to pass in so many different entities as possible arugments here.\n             * \n             * This should also allow caching of balances if they are not fetched as a nested field,\n             * but rather a top level field per address.\n             */ \n            async (entity: Account | LbpPool | XykPool, args) => {\n                let assetIds;\n                \n                // TODO: how to extract the typename from the LbpPool[__typename] directly?\n                if (entity.__typename === 'LBPPool' || entity.__typename === 'XYKPool') {\n                    entity = (entity as LbpPool | XykPool);\n                    assetIds = [entity.assetInId, entity.assetOutId];\n                }\n\n                return (await getBalancesByAddress(entity.id, assetIds))\n                    ?.map(balance => ({\n                        ...balance,\n                        __typename,\n                        id: `${entity.id}-${balance.assetId}`,\n                    }))\n            }, \n            [getBalancesByAddress]\n        ),\n        'balances'\n    );\n\n    return {\n        balances\n    }\n}","import { useCallback } from 'react';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport { Vec } from '@polkadot/types';\nimport { VestingScheduleOf, BalanceOf } from '@open-web3/orml-types/interfaces'\nimport { find, first } from 'lodash';\nimport { ApiPromise } from '@polkadot/api';\nimport { Codec } from '@polkadot/types/types';\n\nexport const balanceLockDataType = 'Vec<BalanceLock>';\nexport const tokensLockDataType = balanceLockDataType;\n\nexport const vestingBalanceLockId = 'ormlvest';\n\nexport const vestingScheduleDataType = 'Vec<VestingScheduleOf>';\n\nexport interface OrmlTokensBalanceLock {\n    id?: string,\n    amount?: number,\n}\n\nexport const getLockedBalanceByAddressAndLockId = async (\n    apiInstance: ApiPromise,\n    address: string,\n    lockId: string\n) => {\n    const lockedNativeBalance = find(\n        apiInstance.createType(\n            balanceLockDataType,\n            await apiInstance.query.balances.locks(address)\n        ),\n        lockedAmount => (\n            lockedAmount.id.eq(lockId)\n        )\n    );\n\n    const tokenBalanceLocks = (await apiInstance.query.tokens.locks.entries(address))\n        .map(([_storageKey, codec]: [any, Codec]) => {\n            const tokenBalanceLock = (codec.toJSON() as any)[0] as unknown as OrmlTokensBalanceLock;\n            return {\n                id: tokenBalanceLock?.id,\n                amount: tokenBalanceLock?.amount?.toString()\n            }\n        });\n    \n    const lockedTokensBalance = find(\n        tokenBalanceLocks,\n        lockedAmount => (\n            lockedAmount?.id === lockId \n        )\n    );\n    \n    return lockedNativeBalance || lockedTokensBalance;\n}\n\nexport const useGetVestingScheduleByAddress = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    const getVestingScheduleByAddress = useCallback(async (address?: string) => {\n        if (!apiInstance || !address) return;\n\n        // TODO: instead of multiple .createType calls, use the following\n        // https://github.com/AcalaNetwork/acala.js/blob/9634e2291f1723a84980b3087c55573763c8e82e/packages/sdk-core/src/functions/getSubscribeOrAtQuery.ts#L4\n        const vestingSchedule = first(\n            apiInstance.createType(\n                vestingScheduleDataType,\n                await apiInstance.query.vesting.vestingSchedules(address)\n            ) as Vec<VestingScheduleOf>\n        );\n\n        const lockedVestingAmount = await getLockedBalanceByAddressAndLockId(\n            apiInstance,\n            address,\n            vestingBalanceLockId\n        );\n\n        // TODO: are we sure this really conforms with the graphql VestingSchedule type\n        // in all conditions?\n        return {\n            // TODO: add a claimableAmount (https://gist.github.com/maht0rz/53466af0aefba004d5a4baad23f8ce26)\n            remainingVestingAmount: lockedVestingAmount?.amount?.toString(),\n            start: vestingSchedule?.start.toString(),\n            period: vestingSchedule?.period.toString(),\n            periodCount: vestingSchedule?.periodCount.toString(),\n            perPeriod: vestingSchedule?.perPeriod.toString()\n        }\n\n    }, [apiInstance, loading]);\n\n    return getVestingScheduleByAddress;\n}","import { useCallback } from 'react'\nimport { Account } from '../../generated/graphql';\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\nimport { useGetVestingScheduleByAddress } from './useGetVestingScheduleByAddress';\n\nexport const useVestingScheduleQueryResolvers = () => {\n    const getVestingScheduleByAddress = useGetVestingScheduleByAddress();\n    const vestingSchedule = useResolverToRef(\n        useCallback(\n            async (account: Account) => await getVestingScheduleByAddress(account.id), \n            [getVestingScheduleByAddress]\n        ),\n        'vestingSchedule'\n    );\n\n    return {\n        vestingSchedule\n    }\n}","import { web3Accounts, web3Enable } from '@polkadot/extension-dapp';\nimport { decodeAddress, encodeAddress } from '@polkadot/util-crypto';\nimport { find } from 'lodash';\nimport { useCallback } from 'react';\n\n// prefix for the ss58 address formatting of substrate addresses\nexport const basiliskAddressPrefix = 10041;\n\n/**\n * Used to fetch either all accounts, or accounts matching the given\n * set of parameters e.g. 'isActive'.\n */\nexport const useGetAccounts = () =>\n  useCallback(\n    async (\n      persistedActiveAccountId: string | undefined,\n      isActive: boolean | undefined\n    ) => {\n      // TODO: use `config.appName`\n      // ensure we're connected to the polkadot.js extension\n      await web3Enable('basilisk-ui');\n\n      // get all the accounts from the polkadot.js extension\n      const accounts = (await web3Accounts())\n        // transform the returned accounts into the required entity format\n        .map((account) => {\n          const address = encodeAddress(\n            decodeAddress(account.address),\n            basiliskAddressPrefix\n          );\n          return {\n            id: address,\n            name: account.meta.name,\n            isActive: false,\n          };\n        })\n        // mark the active account based on the current persisted account\n        .map((account) => ({\n          ...account,\n          isActive: persistedActiveAccountId === account.id,\n        }));\n\n      // if we're filtering for an active account, return just the single active account\n      if (isActive) {\n        return find(accounts, { isActive: isActive });\n      }\n\n      // return all retrieved accounts\n      return accounts;\n    },\n    []\n  );\n","import { isArray } from 'lodash';\nimport { useCallback } from 'react';\nimport { useGetAccounts } from '../useGetAccounts';\nimport { usePersistActiveAccount } from '../usePersistActiveAccount';\nimport { useResolverToRef } from './useAccountsMutationResolvers';\n\nexport interface AccountsQueryResolverArgs {\n    isActive?: boolean\n}\n\nexport const __typename = 'Account';\n\nexport const useGetAccountsQueryResolver = () => {\n    const [persistedActiveAccount] = usePersistActiveAccount();\n    const getAccounts = useGetAccounts();\n\n    return useResolverToRef(\n        useCallback(async (\n            _obj,\n            args: AccountsQueryResolverArgs \n        ) => {\n            const accounts = await getAccounts(\n                persistedActiveAccount?.id,\n                args?.isActive,\n            );\n\n            // if no results were found, return undefined/null\n            // this is useful when un-setting the active account\n            if (!accounts) {\n                return null;\n            };\n    \n            return isArray(accounts)\n                ? accounts.map(account => ({\n                    ...account,\n                    __typename\n                }))\n                : ({\n                    // just a single account\n                    ...accounts,\n                    __typename\n                })\n        }, [\n            persistedActiveAccount,\n            getAccounts\n        ]),\n        'accounts'\n    )\n}","import { useQuery } from '@apollo/client';\nimport { loader } from 'graphql.macro';\nimport { LastBlock, Query } from '../../generated/graphql';\n\n\nexport const GET_LAST_BLOCK = loader('./graphql/GetLastBlock.query.graphql');\nexport interface GetLastBlockQueryResponse {\n    lastBlock: Query['lastBlock']\n}\n\nexport const useLastBlockQuery = () => useQuery<GetLastBlockQueryResponse>(GET_LAST_BLOCK);","import constate from 'constate';\nimport { useCallback, useEffect, useState } from 'react';\nimport { LastBlock } from '../../generated/graphql';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport { Option } from '@polkadot/types'\nimport BN from 'bn.js';\nimport { Codec } from '@polkadot/types/types';\n\nexport const validationDataDataType = 'Option<PolkadotPrimitivesV1PersistedValidationData>';\nexport interface PolkadotPrimitivesV1PersistedValidationData {\n    relayParentNumber: number\n}\nexport type ValidationData = PolkadotPrimitivesV1PersistedValidationData\n\n// TODO: lift up using constate\nexport const useSubscribeNewBlock = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n    const [lastBlock, setLastBlock] = useState<Partial<LastBlock> | undefined>(undefined);\n\n    const subscribeNewBlocks = useCallback(() => {\n        if (!apiInstance) return;\n        // TODO: how to unsubscribe?\n        apiInstance.derive.chain\n            .subscribeNewBlocks(async (block) => {\n                const validationData = await apiInstance.query.parachainSystem.validationData();\n\n                const validationDataOption = apiInstance.createType(\n                    validationDataDataType,\n                    validationData\n                );\n                \n                // TODO: this will only update the block if the relay chain block number is known\n                if (validationDataOption.isSome) {\n                    const validationData = validationDataOption.toJSON() as unknown as PolkadotPrimitivesV1PersistedValidationData;\n                    setLastBlock({\n                        parachainBlockNumber: block.block.header.number.toString(),\n                        relaychainBlockNumber: '821' || validationData.relayParentNumber.toString()\n                    })\n                }                \n            })\n\n    }, [apiInstance]);\n\n    useEffect(() => {\n        if (loading) return;\n        subscribeNewBlocks();\n    }, [loading, subscribeNewBlocks])\n\n    return lastBlock;\n}\n\nexport const [LastBlockProvider, useLastBlockContext] = constate(useSubscribeNewBlock);","import { ApolloCache, ApolloClient, NormalizedCacheObject, useApolloClient } from '@apollo/client';\nimport { relativeTimeRounding } from 'moment';\nimport { useEffect } from 'react';\nimport { LastBlock } from '../../generated/graphql';\nimport { GetLastBlockQueryResponse, GET_LAST_BLOCK } from './useLastBlockQuery';\nimport { useLastBlockContext } from './useSubscribeNewBlockNumber'\n\nexport const __typename = 'LastBlock';\nexport const id = __typename;\n\nexport const writeLastBlock = (cache: ApolloCache<NormalizedCacheObject>, lastBlock: LastBlock) => {\n    return cache.writeQuery<GetLastBlockQueryResponse>({\n        query: GET_LAST_BLOCK,\n        data: {\n            lastBlock\n        }\n    })\n}\nexport const useRefetchWithNewBlock = (client: ApolloClient<NormalizedCacheObject>) => {\n    const lastBlock = useLastBlockContext();\n\n    useEffect(() => {\n        writeLastBlock(client.cache, {\n            __typename,\n            id,\n            ...lastBlock\n        });\n    }, []);\n\n    useEffect(() => {\n        if (!lastBlock) return;\n\n        const lastBlockData = client.cache.readQuery<GetLastBlockQueryResponse>({\n            query: GET_LAST_BLOCK\n        });\n\n        if (!lastBlockData?.lastBlock?.parachainBlockNumber) {\n            // received the first real lastBlockNumber, don't refetch just yet\n            writeLastBlock(client.cache, {\n                __typename,\n                id,\n               ...lastBlock\n            })\n        } else {\n            // lastBlockNumber has been updated, and it's not the first time\n            // refetch queries that depend on the lastBlockNumber\n            client.refetchQueries({\n                updateCache(cache) {\n                    writeLastBlock(cache, {\n                        __typename,\n                        id,\n                        ...lastBlock\n                    })\n                }\n            })\n        }\n    }, [lastBlock]);\n}","import { useApolloClient, useQuery } from '@apollo/client';\nimport constate from 'constate';\nimport { loader } from 'graphql.macro';\nimport { useEffect } from 'react';\nimport { Query } from '../../../generated/graphql';\n\nexport const GET_ACTIVE_ACCOUNT = loader(\n  './../graphql/GetActiveAccount.query.graphql'\n);\n\nexport interface GetActiveAccountQueryResponse {\n  account: Query['account'];\n  lastBlock: Query['lastBlock'];\n}\n\n// TODO: turn this into a lazy query instead, so it does not get fetched right away\nexport const useGetActiveAccountQuery = () => {\n  const client = useApolloClient();\n  const result = useQuery<GetActiveAccountQueryResponse>(GET_ACTIVE_ACCOUNT, {\n    notifyOnNetworkStatusChange: true,\n  });\n\n  // when the active account updates, refetch the config\n  // since the config for `feePaymentAsset` depends on the active account\n  useEffect(() => {\n    client.refetchQueries({\n      // include: [GET_CONFIG]\n    });\n  }, [result.data?.account?.id, client]);\n\n  return result;\n};\nexport const [GetActiveAccountQueryProvider, useGetActiveAccountQueryContext] =\n  constate(useGetActiveAccountQuery);\n","import { useCallback } from 'react'\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport { web3FromAddress } from '@polkadot/extension-dapp';\nimport { ClaimVestedAmountMutationVariables } from './useClaimVestedAmountMutation';\nimport { ExtrinsicStatus } from '@polkadot/types/interfaces/author';\nimport { DispatchError, EventRecord } from '@polkadot/types/interfaces/system';\nimport log from 'loglevel';\nimport { ApolloCache, NormalizedCacheObject } from '@apollo/client';\nimport { GetActiveAccountQueryResponse, GET_ACTIVE_ACCOUNT } from '../accounts/queries/useGetActiveAccountQuery';\nimport { ApiPromise } from '@polkadot/api';\n\n/**\n * Run an async function and handle the thrown errors\n * with an array of error handlers, which may handle the errors gracefully\n * \n * @param fn \n * @param errorHandlers \n * @returns \n */\nexport type resolve = (result?: any) => void;\nexport type reject = (error?: any) => void;\nexport const withGracefulErrors = async (\n    fn: (resolve: resolve, reject: reject) => Promise<any>,\n    errorHandlers: ((error: any) => void)[]\n) => {\n    return new Promise<any>(async (resolve, reject) => {\n        try {\n            resolve(await fn(resolve, reject));\n        } catch (e: any) {\n            console.log('graceful error', e);\n            e = errorHandlers.reduce((e, errorHandler) => errorHandler(e), e);\n            // rejecting this promise with an error instead of throwing an error\n            // is necessary to reflect the apollo resolver loading state correctly\n            e ? reject(e) : resolve(null)\n        }\n    })\n}\n\nexport const cancelledErrorMessage = 'Cancelled';\n\n/**\n * This is an example graceful error handler,\n * if this would return `e` instead of `void`,\n * then the following graceful error handler would be triggered,\n * or by default the error would be thrown.\n * \n * @param e\n * @returns \n */\nexport const gracefulExtensionCancelationErrorHandler = (e: any) => {\n    if ((e as Error)?.message === cancelledErrorMessage) {\n        log.error('Operation presumably cancelled by the user in the Polkadot.js extension')\n        return;\n    }\n    return e;\n}\n\nexport const vestingClaimHandler = (resolve: resolve, reject: reject, apiInstance?: ApiPromise) => ({\n    status,\n    events = [],\n    dispatchError\n}: {\n    status: ExtrinsicStatus,\n    events: EventRecord[],\n    dispatchError?: DispatchError\n}) => {\n    if (status.isFinalized) log.info('operation finalized')\n\n    // TODO: extract intention registred for exchange buy/sell\n    events.forEach(({ event: { data, method, section }, phase }) => {\n        console.log('event handler', phase.toString(), `: ${section}.${method}`, data.toString());\n    });\n\n    // TODO: handle status via the action log / notification stack\n    if (status.isInBlock) {\n        console.log('is in block', status.createdAtHash?.toString());\n        if (dispatchError?.isModule) {\n            return log.info('operation unsuccessful',\n                !apiInstance\n                    ? dispatchError\n                    : apiInstance.registry.findMetaError(dispatchError.asModule)\n            );\n        }\n\n        return log.info('operation successful');\n    }\n\n    // if the operation has been broadcast, finish the mutation\n    if (status.isBroadcast) {\n        log.info('transaction has been broadcast', status.hash.toHuman());\n        return resolve();\n    }\n    if (dispatchError) {\n        log.error('There was a dispatch error', dispatchError);\n        return reject('Dispatch error');\n    }\n};\n\nexport const noAccountSelectedError = 'No Account selected';\nexport const polkadotJsNotReadyYetError = 'Polkadot.js is not ready yet';\n\nexport const useVestingMutationResolvers = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    const claimVestedAmount = useResolverToRef(\n        useCallback(async (\n            _obj,\n            variables: ClaimVestedAmountMutationVariables,\n            { cache }: { cache: ApolloCache<NormalizedCacheObject> }\n        ) => {\n            const address = variables?.address\n                ? variables.address\n                : cache.readQuery<GetActiveAccountQueryResponse>({\n                    query: GET_ACTIVE_ACCOUNT\n                })?.account?.id;\n\n            // TODO: error handling?\n            if (!address) throw new Error(noAccountSelectedError);\n            if (loading || !apiInstance) throw new Error(polkadotJsNotReadyYetError);\n\n            // // TODO: why does this not return a tx hash?\n            return await withGracefulErrors(async (resolve, reject) => {\n                const { signer } = await web3FromAddress(address);\n                await apiInstance.tx.vesting.claim()\n                    .signAndSend(\n                        address,\n                        { signer },\n                        vestingClaimHandler(resolve, reject)\n                    )\n            }, [\n                gracefulExtensionCancelationErrorHandler\n            ])\n\n        }, [loading, apiInstance]),\n        'claimVestedAmount'\n    )\n\n    return {\n        claimVestedAmount\n    }\n}","import { web3FromAddress } from '@polkadot/extension-dapp';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport { gracefulExtensionCancelationErrorHandler, polkadotJsNotReadyYetError, reject, resolve, withGracefulErrors } from '../vesting/useVestingMutationResolvers';\nimport { TransferBalanceMutationVariables } from './useTransferBalanceMutation';\nimport { ExtrinsicStatus } from '@polkadot/types/interfaces/author';\nimport { DispatchError } from '@polkadot/types/interfaces/system';\nimport log from 'loglevel';\nimport { ApiPromise } from '@polkadot/api';\nimport { RuntimeDispatchInfo } from '@polkadot/types/interfaces/payment';\n\n// TODO: use validate JSON schema module of some sort\nexport const invalidTransferVariablesError = 'Invalid transfer parameters provided';\n\nexport const transferBalanceHandler = (\n    apiInstance: ApiPromise,\n    resolve: resolve, \n    reject: reject\n) => ({\n    status,\n    dispatchError\n}: {\n    status: ExtrinsicStatus,\n    dispatchError?: DispatchError\n}) => {\n    if (status.isFinalized) log.info('operation finalized')\n\n    // TODO: handle status via the action log / notification stack\n    if (status.isInBlock) {\n        if (dispatchError?.isModule) {\n            return log.error('transfer unsuccessful', \n                apiInstance.registry.findMetaError(dispatchError.asModule)\n            );\n        }\n\n        return log.info('transfer successful');\n    }\n\n    // if the operation has been broadcast, finish the mutation\n    if (status.isBroadcast) {\n        log.info('transaction has been broadcast');\n        return resolve();\n    }\n    if (dispatchError) {\n        log.error('There was a dispatch error', \n            apiInstance.registry.findMetaError(dispatchError.asModule)\n        );\n        return reject();\n    }\n}\n\nexport const transferBalanceExtrinsic = (apiInstance: ApiPromise) => apiInstance.tx.currencies.transfer;\n\nexport const useEstimateTransferBalance = ({ from, to, currencyId, amount }: TransferBalanceMutationVariables) => {\n    const { apiInstance } = usePolkadotJsContext();\n    const [paymentInfo, setPaymentInfo] = useState<RuntimeDispatchInfo | undefined>(undefined);\n\n    const estimatePaymentInfo = useCallback(async () => {\n        if (!apiInstance || !from || !to || !currencyId || !amount) return setPaymentInfo(undefined);\n        \n        const paymentInfo = await transferBalanceExtrinsic(apiInstance)\n                .apply(apiInstance, [to, currencyId, amount])\n                .paymentInfo(from);\n        \n        setPaymentInfo(paymentInfo);\n\n    }, [apiInstance, from, to, currencyId, amount, setPaymentInfo]);\n\n    return { estimatePaymentInfo, paymentInfo };\n}\n\nexport const useBalanceMutationResolvers = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    const transferBalance = useResolverToRef(\n        useCallback(async (\n            _obj,\n            { from, to, currencyId, amount }: TransferBalanceMutationVariables\n        ) => {\n            if (!from || !to || !currencyId || !amount) throw new Error(invalidTransferVariablesError);\n            if (loading || !apiInstance) throw new Error(polkadotJsNotReadyYetError);\n\n            return withGracefulErrors(async (resolve, reject) => {\n                const { signer } = await web3FromAddress(from);\n                await transferBalanceExtrinsic(apiInstance).apply(apiInstance, [to, currencyId, amount])\n                    .signAndSend(\n                        from,\n                        { signer },\n                        transferBalanceHandler(apiInstance, resolve, reject)\n                    )\n            }, [\n                gracefulExtensionCancelationErrorHandler\n            ]);\n        }, [apiInstance, loading])\n    )\n\n    return {\n        transferBalance\n    }\n}","import { web3Enable } from '@polkadot/extension-dapp';\nimport { useCallback } from 'react'\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\n\nexport const __typename = 'Extension';\nexport const id = __typename;\nexport const useExtensionQueryResolvers = () => {\n    /**\n     * TODO: handle the followingc cases gracefully:\n     * - pending authorization request exists\n     * - user rejects the connection in the extension\n     * - app tries to connect again, after the connection has been rejected\n     */\n    const extension = useResolverToRef(\n        useCallback(async () => {\n            const extensions = await web3Enable('basilisk-ui');\n            return {\n                __typename,\n                id,\n                isAvailable: !!extensions.length,\n            };\n        }, [])\n    )\n\n    return {\n        extension\n    }\n}","import { ApolloCache, NormalizedCacheObject } from '@apollo/client';\nimport { useCallback } from 'react'\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\nimport { GetActiveAccountQueryResponse, GET_ACTIVE_ACCOUNT } from '../accounts/queries/useGetActiveAccountQuery';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs';\nimport { usePersistentConfig } from './usePersistentConfig';\n\nexport const accountCurrencyMapDataType = 'Option<u32>';\n\nexport const __typename = 'Config';\nexport const id = __typename;\n\nexport const nativeAssetId = '0';\n\nexport const useConfigQueryResolvers = () => {\n    const [persistedConfig] = usePersistentConfig();\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    const config = useResolverToRef(\n        useCallback(async (\n            _obj,\n            _variables,\n            { cache }: { cache: ApolloCache<NormalizedCacheObject> }\n        ) => {\n            if (!apiInstance || loading) return;\n\n            // TODO: evict config from the cache after active account changes\n            const address = cache.readQuery<GetActiveAccountQueryResponse>({\n                query: GET_ACTIVE_ACCOUNT\n            })?.account?.id;\n\n            let feePaymentAsset =  address\n                ? apiInstance.createType(\n                    accountCurrencyMapDataType,\n                    await apiInstance.query.multiTransactionPayment.accountCurrencyMap(address)\n                )?.toHuman()\n                : null\n\n            feePaymentAsset = feePaymentAsset ? feePaymentAsset : nativeAssetId\n            \n            return {\n                __typename,\n                id,\n                ...persistedConfig,\n                feePaymentAsset\n            };\n        }, [apiInstance, loading])\n    );\n\n    return {\n        config\n    }\n}","import { ApolloCache, NormalizedCacheObject } from '@apollo/client';\nimport { web3FromAddress } from '@polkadot/extension-dapp';\nimport { useCallback } from 'react'\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\nimport { GetActiveAccountQueryResponse, GET_ACTIVE_ACCOUNT } from '../accounts/queries/useGetActiveAccountQuery';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs';\nimport { gracefulExtensionCancelationErrorHandler, reject, resolve, vestingClaimHandler, withGracefulErrors } from '../vesting/useVestingMutationResolvers';\nimport { defaultConfigValue, usePersistentConfig } from './usePersistentConfig';\nimport { SetConfigMutationVariables } from './useSetConfigMutation';\n\nexport const defaultAssetId = '0';\n\nexport const setCurrencyHandler = (resolve: resolve, reject: reject) => {\n    return vestingClaimHandler(resolve, reject);\n}\n\nexport const useConfigMutationResolvers = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n    const [_persistedConfig, setPersistedConfig] = usePersistentConfig();\n\n    const setConfig = useResolverToRef(\n        useCallback(async (\n            _obj,\n            args: SetConfigMutationVariables,\n            { cache }: { cache: ApolloCache<NormalizedCacheObject> }\n        ) => {\n            // TODO: error handling?\n            if (!apiInstance || loading) return;\n\n            // TODO: return an optimistic update to the cache with the new config\n            await withGracefulErrors(async (resolve, reject) => {\n                const address = cache.readQuery<GetActiveAccountQueryResponse>({\n                    query: GET_ACTIVE_ACCOUNT\n                })?.account?.id;\n\n                if (!address) return resolve();\n\n                const { signer } = await web3FromAddress(address);\n                \n                await apiInstance.tx.multiTransactionPayment.setCurrency(\n                    args.config?.feePaymentAsset || defaultAssetId\n                )\n                    .signAndSend(\n                        address,\n                        { signer },\n                        setCurrencyHandler(resolve, reject)\n                    )\n            }, [\n                gracefulExtensionCancelationErrorHandler\n            ]);\n            \n            const persistableConfig = args.config;\n            // there's no point in persisting the feePaymentAsset since it will\n            // be refetched from the node anyways\n            delete persistableConfig?.feePaymentAsset;\n            \n            setPersistedConfig(() => persistableConfig || defaultConfigValue);\n        }, [apiInstance, loading])\n    );\n\n    return {\n        setConfig\n    }\n}","import { useCallback } from 'react'\nimport { FeePaymentAsset } from '../../generated/graphql';\nimport { useResolverToRef } from '../accounts/resolvers/useAccountsMutationResolvers'\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs';\n\nexport const __typename: FeePaymentAsset['__typename'] = 'FeePaymentAsset';\nexport const useFeePaymentAssetsQueryResolvers = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n    const feePaymentAssets = useResolverToRef(\n        useCallback(async () => {\n            if (!apiInstance || loading) return;\n\n            const acceptedCurrencies = await apiInstance.query.multiTransactionPayment.acceptedCurrencies.entries()\n            const feePaymentAssets: FeePaymentAsset[] = acceptedCurrencies.map((acceptedCurrency) => {\n                const assetId = (acceptedCurrency[0].toHuman() as string[])[0];\n                return {\n                    // TODO: is there a safer type way to do this?\n                    // TODO: maybe? combine this with known asset data\n                    __typename,\n                    id: assetId,\n                    assetId: assetId,\n                    fallbackPrice: acceptedCurrency[1].toString()\n                }\n            })\n            \n            return feePaymentAssets;\n        }, [apiInstance, loading])\n    );\n\n    return {\n        feePaymentAssets\n    }\n}","import constate from 'constate';\nimport { useEffect, useState } from 'react'\n\n// TODO: figure out how to extract types from the wasm type definitions\nexport interface HydraDxMathXyk {\n    get_spot_price: (a: string, b: string, c: string) => string | undefined,\n    calculate_in_given_out: (a: string, b: string, c: string) => string | undefined,\n    calculate_out_given_in: (a: string, b: string, c: string) => string | undefined\n}\n\nexport interface HydraDxMathLbp {\n    calculate_linear_weights: (start_x: string, end_x: string, start_y: string, end_y: string, at: string) => string,\n    calculate_in_given_out: (s: string, b: string, s_w: string, b_w: string, a: string) => string,\n    calculate_out_given_in: (s: string, b: string, s_w: string, b_w: string, a: string) => string,\n    get_spot_price: (s: string, b: string, s_w: string, b_w: string, a: string) => string,\n}\n\nexport interface HydraDxMath {\n    xyk: HydraDxMathXyk,\n    lbp: HydraDxMathLbp\n}\n\nexport const loadMath = async (): Promise<HydraDxMath> => {\n    return {\n        xyk: await import('hydra-dx-wasm/build/xyk/bundler'),\n        lbp: await import('hydra-dx-wasm/build/lbp/bundler') as unknown as HydraDxMathLbp\n    }\n}\n\n/**\n * Load the wasm math module\n * @returns \n */\nexport const useMath = () => {\n    const [wasm, setWasm] = useState<{\n        instance: HydraDxMath | undefined,\n        loading: boolean\n    } | undefined>({\n        instance: undefined,\n        loading: true,\n    });\n\n    useEffect(() => {\n        (async () => {\n            setWasm({\n                // TODO: if the module path is a variable, the module can't be found for some reason\n                instance: await loadMath(),\n                loading: false,\n            });\n        })();\n    }, [setWasm])\n\n    // TODO if we need additional math functions outside of wasm,\n    // inject them here\n    return { math: wasm?.instance, loading: wasm?.loading };\n}\n\nexport const [MathProvider, useMathContext] = constate(useMath);","import { useCallback } from 'react';\nimport { XykPool } from '../../generated/graphql';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport type { StorageKey } from '@polkadot/types';\nimport type { AnyTuple, Codec } from '@polkadot/types/types';\nimport { ApiPromise } from '@polkadot/api';\n\nexport type PoolAssets = string[];\nexport const poolAssetsDataType = '(u32, u32)';\n\nexport const mapToPoolId = ([storageKey, codec]: [StorageKey<AnyTuple>, Codec]): [string, Codec] => {\n    const id = (storageKey.toHuman() as string[])[0];\n    return [id, codec];\n}\n\nexport const mapToPool = (apiInstance: ApiPromise) => ([id, codec]: [string, Codec]) => {\n    const poolAssets = codec.toHuman() as PoolAssets;\n\n    if (!poolAssets) return;\n\n    return {\n        id,\n        assetInId: poolAssets[0],\n        assetOutId: poolAssets[1],\n    } as XykPool\n}\n\nexport const useGetXykPools = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    return useCallback(async (poolId?: string, assetIds?: string[]) => {\n        if (!apiInstance || loading) return [];\n\n        if (poolId) {\n            return [(await apiInstance.query.xyk.poolAssets(poolId))]\n                .map(pool => [poolId, pool] as [string, Codec])\n                .map(mapToPool(apiInstance))\n        }\n    \n        return (await apiInstance.query.xyk.poolAssets.entries())\n            .map(mapToPoolId)  \n            .map(mapToPool(apiInstance)) || []\n    }, [\n        apiInstance,\n        loading\n    ])\n}","import BigNumber from 'bignumber.js'\n\nexport const hundredWithPrecision6 = new BigNumber('100')\n    .multipliedBy(\n        new BigNumber('10').pow('6')\n    )\n\n/**\n * LBP pools specify weights only for the first asset in the pool,\n * the `opposite` weights need to be calculated by subtracting from `100`\n * @param weight \n * @returns Calculated oppostite weight as `100 - weight`\n */\nexport const calculateOppositeAssetWeight = (weight: string): string => {\n    return new BigNumber(hundredWithPrecision6)\n        .minus(\n            new BigNumber(weight)\n        )\n        .toFixed(0)\n}\n","import { LbpAssetWeights, LbpPool, Pool } from '../../../generated/graphql';\nimport { HydraDxMath } from '../../math/useMath';\n\n/**\n * Used to determine the current asset weight, given the initial/final weights \n * and the interval it should be interpolated on.\n * \n * @param math \n * @param pool \n * @param weights \n * @param relaychainBlockNumber \n * @returns Current asset weight, calculated lineary from the inputs above\n */\nexport const calculateCurrentAssetWeight = (\n    math: HydraDxMath,\n    pool: Pick<LbpPool, 'startBlock' | 'endBlock'>,\n    weights: Pick<LbpAssetWeights, 'initial' | 'final'>,\n    relaychainBlockNumber: string\n): string => {\n    return math.lbp.calculate_linear_weights(\n        pool.startBlock,\n        pool.endBlock,\n        weights.initial,\n        weights.final,\n        relaychainBlockNumber\n    );\n}","import { ApolloClient, NormalizedCache } from '@apollo/client';\nimport { GetLastBlockQueryResponse, GET_LAST_BLOCK } from './useLastBlockQuery';\n\nexport const readLastBlock = (client: ApolloClient<object>) => {\n    return client.cache.readQuery<GetLastBlockQueryResponse>({\n        query: GET_LAST_BLOCK\n    });\n}","import { AccountId, AssetId } from '@open-web3/orml-types/interfaces';\nimport { ApiPromise } from '@polkadot/api';\nimport { useCallback } from 'react';\nimport { Fee, LbpAssetWeights, LbpPool } from '../../generated/graphql';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs';\nimport type { Codec } from '@polkadot/types/types';\nimport { mapToPoolId } from './useGetXykPools';\nimport { calculateOppositeAssetWeight } from './lbp/calculateOppositeAssetWeight';\nimport { HydraDxMath, useMath, useMathContext } from '../math/useMath';\nimport { calculateCurrentAssetWeight } from './lbp/calculateCurrentAssetWeight';\nimport { partial } from 'lodash';\nimport { ApolloClient, useApolloClient } from '@apollo/client';\nimport { readLastBlock } from '../lastBlock/readLastBlock';\nimport { getLockedBalanceByAddressAndLockId } from '../vesting/useGetVestingScheduleByAddress';\nimport log from 'loglevel';\nimport BigNumber from 'bignumber.js';\n\nexport type AssetPair = number[];\nexport interface PoolData {\n    assets: AssetPair,\n    feeCollector: string,\n    fee: {\n        numerator: number,\n        denominator: number\n    },\n    repayTarget: number,\n    initialWeight: number,\n    finalWeight: number,\n    start: number,\n    end: number,\n}\n\n// ID isnt parsed when converting the codec into a JSON\nexport const lbpRepayFeeLockId = '0x6c6270636c6c6374' // 'lbpcllct';\nexport const balanceDataType = 'BalanceOf';\n\n// fee applied in a case when the repayTarget has not been reached\nconst repayFee: Fee = {\n    numerator: '2',\n    denominator: '10',\n}\n\n/**\n * @param math \n * @param client \n * @returns Function to format the given codec into an LBPPool\n */\nexport const mapToPool = (\n    math: HydraDxMath,\n    client: ApolloClient<object>,\n    apiInstance: ApiPromise\n) => \n    /**\n     * @param [id, codec]\n     * @returns LBPPool parsed from the coded provided as an argument\n     */\n    async ([id, codec]: [string, Codec]) => {\n        // TODO this is possibly VERY unsafe and needs to be revisited for type parsing / creation\n        const poolData = codec.toJSON() as unknown as PoolData;\n        const lastBlockData = readLastBlock(client);\n        const relaychainBlockNumber = lastBlockData?.lastBlock?.relaychainBlockNumber;\n        \n        if (!poolData || !relaychainBlockNumber) return;\n\n        const feeCollector = poolData.feeCollector.toString();\n        const repayTarget = apiInstance.createType(\n            balanceDataType,\n            poolData.repayTarget.toString()\n        ).toString()\n\n        // construct the pool entity without weights\n        const partialPool: Omit<LbpPool, 'assetBWeights' | 'assetAWeights' | 'repayTargetReached' | 'fee'> = {\n            id,\n            assetInId: poolData.assets[0].toString(),\n            assetOutId: poolData.assets[1].toString(),\n            startBlock: poolData.start.toString(),\n            endBlock: poolData.end.toString()\n        }\n\n        // determine weights for asset A\n        const partialAssetAWeights: Omit<LbpAssetWeights, 'current'> = {\n            initial: poolData.initialWeight.toString(),\n            final: poolData.finalWeight.toString(),\n        }\n\n        const assetAWeights: LbpAssetWeights = {\n            ...partialAssetAWeights,\n            current: calculateCurrentAssetWeight(\n                math,\n                partialPool,\n                partialAssetAWeights,\n                relaychainBlockNumber\n            )\n        }\n\n         // determine weights for asset B\n         const assetBWeights: LbpAssetWeights = {\n            initial: calculateOppositeAssetWeight(assetAWeights.initial),\n            final: calculateOppositeAssetWeight(assetAWeights.final),\n            current: calculateOppositeAssetWeight(assetAWeights.current)\n        }\n\n        // TODO: this function only works by finding the first lock with the given ID\n        // TODO: this data fetching should be moved to a resolver, and this mapper\n        // should be a plain function\n        const feeCollectorBalanceLockAmount = (await getLockedBalanceByAddressAndLockId(\n            apiInstance,\n            feeCollector, \n            lbpRepayFeeLockId\n        ))?.amount?.toString();\n        \n        const repayTargetReached = repayTarget && feeCollectorBalanceLockAmount\n            // if collected fees are greater than the repay target, the repay target has been reached\n            // this means that we won't apply the repay fee down the line\n            ? new BigNumber(feeCollectorBalanceLockAmount).gt(new BigNumber(repayTarget))\n            : false\n\n        const poolFee: Fee = {\n            numerator: poolData.fee.numerator.toString(),\n            denominator: poolData.fee.denominator.toString(),\n        }\n\n        const pool: LbpPool = {\n            ...partialPool,\n            assetAWeights,\n            assetBWeights,\n            repayTargetReached,\n            // if we've haven't reached the repay target, the pool will carry a larger fee\n            fee: repayTargetReached ? poolFee : repayFee\n        };\n\n        return pool;\n    }\n\nexport const getLbpPools = async (\n    apiInstance: ApiPromise,\n    math: HydraDxMath,\n    client: ApolloClient<object>\n) => {\n    return await Promise.all(\n        (await apiInstance.query.lbp.poolData.entries())\n            .map(mapToPoolId) \n            .map(mapToPool(math, client, apiInstance))\n    ) || [];\n}\n\n/**\n * Hook to fetch and map LBPPool data\n * @returns Function that returns the on-chain LBPPool(s)\n */\nexport const useGetLbpPools = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n    const { math } = useMathContext()\n\n    return useCallback(async (client: ApolloClient<object>) => {\n        // return an empty array by default\n        if (!apiInstance || loading || !math) return [];\n        return getLbpPools(apiInstance, math, client);\n    }, [apiInstance, loading, math])\n}","import { ApolloClient } from '@apollo/client';\nimport { ApiPromise } from '@polkadot/api';\nimport log from 'loglevel';\nimport { useCallback } from 'react';\nimport { HydraDxMath, useMathContext } from '../math/useMath';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport { mapToPool } from './useGetLbpPools';\n\nexport const getLbpPool = async (\n    math: HydraDxMath,\n    client: ApolloClient<object>,\n    apiInstance: ApiPromise,\n    poolId: string,\n) => {\n    return await mapToPool(math, client, apiInstance)([\n        poolId,\n        await apiInstance.query.lbp.poolData(poolId)\n    ])\n}\n\nexport const useGetLbpPool = () => {\n    const { apiInstance } = usePolkadotJsContext();\n    const { math } = useMathContext();\n\n    return useCallback(async (\n        client: ApolloClient<object>, \n        poolId?: string\n    ) => {\n        log.debug('useGetLbpPool', apiInstance, poolId, math)\n        if (!apiInstance || !poolId || !math) return;\n        return getLbpPool(math, client, apiInstance, poolId);\n    }, [apiInstance, math])\n}","import { ApolloClient } from '@apollo/client';\nimport { ApiPromise } from '@polkadot/api';\nimport { Codec } from '@polkadot/types/types';\nimport { isArray, isObject } from 'lodash';\nimport log from 'loglevel';\nimport { useCallback } from 'react';\nimport { PoolType } from '../../../components/Chart/shared';\nimport { LbpPool, XykPool } from '../../../generated/graphql';\nimport { useResolverToRef } from '../../accounts/resolvers/useAccountsMutationResolvers';\nimport { __typename } from '../../accounts/resolvers/useGetAccountsQueryResolver';\nimport { usePolkadotJsContext } from '../../polkadotJs/usePolkadotJs';\nimport { useGetLbpPool } from '../useGetLbpPool';\nimport { useGetLbpPools } from '../useGetLbpPools';\nimport { useGetXykPool } from '../useGetXykPool';\nimport { useGetXykPools } from '../useGetXykPools';\n\nexport interface PoolQueryResolverArgs {\n    poolId?: string,\n    assetIds?: string[],\n    poolType?: PoolType\n}\n// Filter those out, until the following issue is implemented\n// https://github.com/galacticcouncil/Basilisk-node/issues/248\nexport const defaultLbpPoolId = 'bXnAY36Vvd3HdWTX5v1Cgej2tYFsq1UpzShWyAQAr5HQ9FaJx';\nexport const defaultXykPoolId = 'bXnAY36Vvd3HdWTX5v1Cgej2tYFsq1UpzShWyAQAr5HQ9FaJx';\n\nexport interface PoolIds {\n    lbpPoolId?: string,\n    xykPoolId?: string\n}\n\nexport const getPoolIdsByAssetIds = async (apiInstance: ApiPromise, assetIds: string[]) => {\n    let lbpPoolId: string | undefined = (await (apiInstance.rpc as any).lbp.getPoolAccount(\n        assetIds[0], assetIds[1]\n    )).toHuman();\n    \n    let xykPoolId: string | undefined = (await (apiInstance.rpc as any).xyk.getPoolAccount(\n        assetIds[0], assetIds[1]\n    )).toHuman();\n\n    return {\n        lbpPoolId,\n        xykPoolId\n    }\n}\n\nexport const useGetPoolsQueryResolver = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n    const getLbpPools = useGetLbpPools();\n    const getXykPools = useGetXykPools();\n    const getXykPool = useGetXykPool();\n    const getLbpPool = useGetLbpPool();\n\n    return useResolverToRef(\n        useCallback(async (\n            _obj,\n            args?: PoolQueryResolverArgs,\n            context?: { client: ApolloClient<object> }\n        ) => {\n            if (!apiInstance || loading || !context?.client) return;\n            log.debug('useGetPoolsQueryResolver', 'fetching pools', args);\n\n            // use the provided poolId\n            let poolId = args?.poolId;\n            let poolIds: PoolIds = {\n                lbpPoolId: poolId,\n                xykPoolId: poolId\n            };\n\n            // if we're querying by assetIds, find the poolIds via RPC\n            if (args?.assetIds) {\n                poolIds = await getPoolIdsByAssetIds(apiInstance, args.assetIds);\n                log.debug('useGetPoolsQueryResolver', 'found poolIDs', poolIds, apiInstance);\n            }\n\n            // if the poolId is specified, try resolving with a single pool\n            if (poolIds.xykPoolId || poolIds.lbpPoolId) {\n                let lbpPool = await getLbpPool(context.client, poolIds.lbpPoolId);\n                let xykPool = await getXykPool(poolIds.xykPoolId);\n        \n                log.debug('useGetPoolsQueryResolver', 'found pools by poolIDs', lbpPool, xykPool);\n\n                // if the assets are matching, its a default value which means the pool was not found\n                if (xykPool?.assetInId === xykPool?.assetOutId) xykPool = undefined;\n                if (lbpPool?.assetInId === lbpPool?.assetOutId) lbpPool = undefined;\n\n                log.debug('useGetPoolsQueryResolver', 'eliminated default value pools', lbpPool, xykPool);\n\n                // TODO: which pool should have priority if both types exist for the same assets?\n                const pool = xykPool || lbpPool;\n                \n                log.debug('useGetPoolsQueryResolver', 'returning a single pool', pool);\n\n                return pool && ({\n                    ...pool,\n                    __typename: xykPool \n                        ? 'XYKPool' as XykPool['__typename']\n                        : lbpPool\n                            ? 'LBPPool' as LbpPool['__typename']\n                            : undefined\n                })\n            }\n\n            // if no extra args were provided, get all the pools\n            const [lbpPools, xykPools] = await Promise.all([\n                getLbpPools(context.client),\n                getXykPools()\n            ]);\n            \n            log.debug('useGetPoolsQueryResolver', 'returning multiple pools', [lbpPools, xykPools]);\n\n            return ([] as (LbpPool | XykPool)[])\n                .concat(\n                    lbpPools\n                        ?.map(pool => ({\n                            ...pool,\n                            __typename: 'LBPPool'\n                        }) as LbpPool)\n                )\n                .concat(\n                    xykPools\n                        ?.map(pool => ({\n                            ...pool,\n                            __typename: 'XYKPool'\n                        }) as XykPool)\n                )\n\n        }, [getLbpPools]),\n        'pools'\n    )\n}","import { useCallback } from 'react';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport { mapToPool } from './useGetXykPools';\n\nexport const useGetXykPool = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    return useCallback(async (poolId?: string) => {\n        if (!apiInstance || loading || !poolId) return;\n\n        return mapToPool(apiInstance)([\n            poolId,\n            await apiInstance.query.xyk.poolAssets(poolId)\n        ]);\n    }, [\n        apiInstance,\n        loading\n    ])\n}","import { useCallback } from 'react';\nimport { Asset } from '../../../generated/graphql';\nimport { useResolverToRef } from '../../accounts/resolvers/useAccountsMutationResolvers';\nimport { usePolkadotJsContext } from '../../polkadotJs/usePolkadotJs'\nimport { useGetAssets } from '../useGetAssets';\n\nexport const __typename: Asset['__typename'] = 'Asset';\n\nexport const useGetAssetsQueryResolver = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n    const getAssets = useGetAssets();\n\n    return useResolverToRef(\n        useCallback(async () => {\n            return (await getAssets())\n                ?.map(asset => ({\n                    ...asset,\n                    __typename\n                }))\n        }, [\n            apiInstance,\n            loading\n        ])\n    )\n}","import { useCallback } from 'react';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\nimport type { Codec } from '@polkadot/types/types';\nimport { ApiPromise } from '@polkadot/api';\nimport { Asset } from '../../generated/graphql';\n\nexport const assetDataType = 'Option<u32>';\n\n// TODO: parse the symbol from the storage key, or use a static client-side symbol map\nexport const mapToAsset = (apiInstance: ApiPromise) => ([_storageKey, codec]: [unknown, Codec]) => {\n    return {\n        id: (apiInstance.createType(\n                assetDataType,\n                codec\n            ).toHuman() as string)\n    } as Asset;\n        \n}\n\nexport const useGetAssets = () => {\n    const { apiInstance, loading } = usePolkadotJsContext();\n\n    return useCallback(async () => {\n        if (!apiInstance || loading) return;\n\n        // TODO: do we wanna order these by id?\n        return (await apiInstance?.query.assetRegistry.assetIds.entries())\n            .map(mapToAsset(apiInstance)) || [];\n    }, [\n        apiInstance,\n        loading\n    ]);\n}","export enum ChartGranularity {\n    // ALL = 'ALL',\n    D30 = 'D30',\n    D7 = 'D7',\n    H24 = 'H24',\n    H1 = 'H1'\n}\n\nexport enum ChartType {\n    PRICE = 'PRICE',\n    VOLUME = 'VOLUME',\n    WEIGHTS = 'WEIGHTS'\n}\n\n\nexport interface Asset {\n    symbol: string | undefined,\n    fullName: string | undefined\n    icon?: string | undefined\n}\n\nexport interface AssetPair {\n    assetA: Asset,\n    assetB: Asset | undefined\n}\n\nexport enum PoolType {\n    LBP = 'LBP',\n    XYK = 'XYK'\n}\n\n// Display data is not in the {x,y} format, since it solely represents\n// an amount in a given asset\nexport interface DisplayData {\n    balance: number | undefined,\n    usdBalance: number | undefined,\n    asset: Asset\n}","import { gql } from '@apollo/client';\nexport type Maybe<T> = T | null;\nexport type Exact<T extends { [key: string]: unknown }> = { [K in keyof T]: T[K] };\nexport type MakeOptional<T, K extends keyof T> = Omit<T, K> & { [SubKey in K]?: Maybe<T[SubKey]> };\nexport type MakeMaybe<T, K extends keyof T> = Omit<T, K> & { [SubKey in K]: Maybe<T[SubKey]> };\n/** All built-in and custom scalars, mapped to their actual values */\nexport type Scalars = {\n  ID: string;\n  String: string;\n  Boolean: boolean;\n  Int: number;\n  Float: number;\n};\n\nexport type Account = {\n  __typename?: 'Account';\n  balances: Array<Balance>;\n  id: Scalars['String'];\n  isActive: Scalars['Boolean'];\n  name?: Maybe<Scalars['String']>;\n  vestingSchedule: VestingSchedule;\n};\n\nexport type Asset = {\n  __typename?: 'Asset';\n  id: Scalars['String'];\n};\n\nexport type Balance = {\n  __typename?: 'Balance';\n  assetId: Scalars['String'];\n  balance: Scalars['String'];\n};\n\nexport type Config = {\n  __typename?: 'Config';\n  appName: Scalars['String'];\n  feePaymentAsset?: Maybe<Scalars['String']>;\n  nodeUrl: Scalars['String'];\n  processorUrl: Scalars['String'];\n};\n\nexport type Extension = {\n  __typename?: 'Extension';\n  isAvailable?: Maybe<Scalars['Boolean']>;\n};\n\nexport type Fee = {\n  __typename?: 'Fee';\n  denominator: Scalars['String'];\n  numerator: Scalars['String'];\n};\n\nexport type FeePaymentAsset = {\n  __typename?: 'FeePaymentAsset';\n  assetId?: Maybe<Scalars['String']>;\n  fallbackPrice?: Maybe<Scalars['String']>;\n};\n\nexport type LbpAssetWeights = {\n  __typename?: 'LBPAssetWeights';\n  current: Scalars['String'];\n  final: Scalars['String'];\n  initial: Scalars['String'];\n};\n\nexport type LbpPool = {\n  __typename?: 'LBPPool';\n  assetAWeights: LbpAssetWeights;\n  assetBWeights: LbpAssetWeights;\n  assetInId: Scalars['String'];\n  assetOutId: Scalars['String'];\n  balances?: Maybe<Array<Balance>>;\n  endBlock: Scalars['String'];\n  fee: Fee;\n  id: Scalars['String'];\n  repayTargetReached: Scalars['Boolean'];\n  startBlock: Scalars['String'];\n};\n\nexport type LastBlock = {\n  __typename?: 'LastBlock';\n  id: Scalars['String'];\n  parachainBlockNumber?: Maybe<Scalars['String']>;\n  relaychainBlockNumber?: Maybe<Scalars['String']>;\n};\n\nexport type Pool = LbpPool | XykPool;\n\nexport type Query = {\n  __typename?: 'Query';\n  _empty?: Maybe<Scalars['String']>;\n  _tradeType?: Maybe<TradeType>;\n  account?: Maybe<Account>;\n  accounts: Array<Account>;\n  assets?: Maybe<Array<Asset>>;\n  config: Config;\n  extension: Extension;\n  feePaymentAssets?: Maybe<Array<FeePaymentAsset>>;\n  lastBlock?: Maybe<LastBlock>;\n  pools?: Maybe<Array<Pool>>;\n};\n\nexport enum TradeType {\n  Buy = 'Buy',\n  Sell = 'Sell'\n}\n\nexport type VestingSchedule = {\n  __typename?: 'VestingSchedule';\n  perPeriod?: Maybe<Scalars['String']>;\n  period?: Maybe<Scalars['String']>;\n  periodCount?: Maybe<Scalars['String']>;\n  remainingVestingAmount?: Maybe<Scalars['String']>;\n  start?: Maybe<Scalars['String']>;\n};\n\nexport type XykPool = {\n  __typename?: 'XYKPool';\n  assetInId: Scalars['String'];\n  assetOutId: Scalars['String'];\n  balances?: Maybe<Array<Balance>>;\n  id: Scalars['String'];\n};\n","import { ApolloCache } from '@apollo/client';\nimport { GetActiveAccountQueryResponse, GET_ACTIVE_ACCOUNT } from './queries/useGetActiveAccountQuery';\n\nexport const readActiveAccount = (\n    cache: ApolloCache<object>\n) => {\n    return cache.readQuery<GetActiveAccountQueryResponse>({\n        query: GET_ACTIVE_ACCOUNT,\n        /**\n         * TODO: if the active account query does not return all the queried data,\n         * such as vesting schedules (fields should be nullable, but they are simply not returned.\n         * Then the cache is incomplete and would return null/undefined, thats why we need to\n         * accept only partial data below.\n         */\n        returnPartialData: true,\n    })?.account\n}","import { ApolloCache } from '@apollo/client'\nimport { ApiPromise } from '@polkadot/api'\nimport { web3FromAddress } from '@polkadot/extension-dapp'\nimport { useCallback } from 'react'\nimport { readActiveAccount } from '../../accounts/readActiveAccount'\nimport { usePolkadotJsContext } from '../../polkadotJs/usePolkadotJs'\nimport { gracefulExtensionCancelationErrorHandler, reject, resolve, vestingClaimHandler, withGracefulErrors } from '../../vesting/useVestingMutationResolvers'\n\nexport const buyHandler = (resolve: resolve, reject: reject, apiInstance: ApiPromise) => {\n    return vestingClaimHandler(resolve, reject, apiInstance);\n}\n\nexport const buy = async (\n    cache: ApolloCache<object>,\n    apiInstance: ApiPromise,\n    assetBuy: string,\n    assetSell: string,\n    amountBuy: string,\n    maxSold: string,\n) => {\n    await withGracefulErrors(async (resolve, reject) => {\n        const activeAccount = readActiveAccount(cache);\n        const address = activeAccount?.id;\n\n        if (!address) return reject(new Error('No active account found'));\n\n        const { signer } = await web3FromAddress(address);\n        \n        await apiInstance.tx.lbp.buy(\n            assetBuy,\n            assetSell,\n            amountBuy,\n            maxSold\n        )\n            .signAndSend(\n                address,\n                { signer },\n                buyHandler(resolve, reject, apiInstance)\n            )\n    }, [\n        gracefulExtensionCancelationErrorHandler\n    ])\n}","import { ApolloCache } from '@apollo/client'\nimport { ApiPromise } from '@polkadot/api'\nimport { web3FromAddress } from '@polkadot/extension-dapp'\nimport { readActiveAccount } from '../../accounts/readActiveAccount'\nimport { gracefulExtensionCancelationErrorHandler, reject, resolve, vestingClaimHandler, withGracefulErrors } from '../../vesting/useVestingMutationResolvers'\n\nexport const sellHandler = (resolve: resolve, reject: reject, apiInstance: ApiPromise) => {\n    return vestingClaimHandler(resolve, reject, apiInstance);\n}\n\nexport const sell = async (\n    cache: ApolloCache<object>,\n    apiInstance: ApiPromise,\n    assetSell: string,\n    assetBuy: string,\n    amountSell: string,\n    minBought: string,\n) => {\n    await withGracefulErrors(async (resolve, reject) => {\n        const activeAccount = readActiveAccount(cache);\n        const address = activeAccount?.id;\n\n        if (!address) return reject(new Error('No active account found'));\n\n        const { signer } = await web3FromAddress(address);\n        \n        await apiInstance.tx.lbp.sell(\n            assetSell,\n            assetBuy,\n            amountSell,\n            minBought\n        )\n            .signAndSend(\n                address,\n                { signer },\n                sellHandler(resolve, reject, apiInstance)\n            )\n    }, [\n        gracefulExtensionCancelationErrorHandler\n    ])\n}","import { ApolloCache, NormalizedCacheObject, useApolloClient } from '@apollo/client';\nimport { ApiPromise } from '@polkadot/api';\nimport { web3FromAddress } from '@polkadot/extension-dapp';\nimport { useCallback } from 'react'\nimport { GetActiveAccountQueryResponse, GET_ACTIVE_ACCOUNT } from '../../accounts/queries/useGetActiveAccountQuery';\nimport { readActiveAccount } from '../../accounts/readActiveAccount';\nimport { usePolkadotJsContext } from '../../polkadotJs/usePolkadotJs';\nimport { withGracefulErrors, gracefulExtensionCancelationErrorHandler, vestingClaimHandler, resolve, reject } from '../../vesting/useVestingMutationResolvers';\n\nexport const xykBuyHandler = (resolve: resolve, reject: reject, apiInstance: ApiPromise) => {\n    return vestingClaimHandler(resolve, reject, apiInstance);\n}\n\nexport const discount = false;\n\nexport const buy = async (\n    cache: ApolloCache<NormalizedCacheObject>,\n    apiInstance: ApiPromise,\n    assetBuy: string, // 1\n    assetSell: string, // 49.7 + 0.2% = 49.9\n    amountBuy: string, // 99\n    maxSold: string, // 49.5 + 0.5%\n) => {\n    await withGracefulErrors(async (resolve, reject) => {\n        const activeAccount = readActiveAccount(cache);\n        const address = activeAccount?.id;\n\n        // TODO: extract this error\n        if (!address) return reject(new Error('No active account found!'));\n\n        const { signer } = await web3FromAddress(address);\n\n        await apiInstance.tx.xyk.buy(\n            assetBuy,\n            assetSell,\n            amountBuy,\n            maxSold,\n            discount\n        )\n            .signAndSend(\n                address,\n                { signer },\n                xykBuyHandler(resolve, reject, apiInstance)\n            )\n    }, [\n        gracefulExtensionCancelationErrorHandler\n    ])\n}","import { ApolloCache, NormalizedCacheObject } from '@apollo/client';\nimport { ApiPromise } from '@polkadot/api';\nimport { web3FromAddress } from '@polkadot/extension-dapp';\nimport { useCallback } from 'react';\nimport { GetActiveAccountQueryResponse, GET_ACTIVE_ACCOUNT } from '../../accounts/queries/useGetActiveAccountQuery';\nimport { readActiveAccount } from '../../accounts/readActiveAccount';\nimport { usePolkadotJsContext } from '../../polkadotJs/usePolkadotJs'\nimport { gracefulExtensionCancelationErrorHandler, reject, resolve, vestingClaimHandler, withGracefulErrors } from '../../vesting/useVestingMutationResolvers';\n\nexport const xykBuyHandler = (resolve: resolve, reject: reject, apiInstance: ApiPromise) => {\n    return vestingClaimHandler(resolve, reject, apiInstance);\n}\n\nexport const discount = false;\n\nexport const sell = async (\n    cache: ApolloCache<NormalizedCacheObject>,\n    apiInstance: ApiPromise,\n    assetSell: string,\n    assetBuy: string,\n    amountSell: string,\n    minBought: string,\n) => {\n    await withGracefulErrors(async (resolve, reject) => {\n        const activeAccount = readActiveAccount(cache);\n        const address = activeAccount?.id;\n\n        if (!address) return reject(new Error('No active account found!'));\n\n        const { signer } = await web3FromAddress(address);\n\n        await apiInstance.tx.xyk.sell(\n            assetSell,\n            assetBuy,\n            amountSell,\n            minBought,\n            discount\n        )\n            .signAndSend(\n                address,\n                { signer },\n                xykBuyHandler(resolve, reject, apiInstance)\n            )\n    }, [\n        gracefulExtensionCancelationErrorHandler\n    ]);\n}","import { useSubmitTradeMutationResolver } from './useSubmitTradeMutationResolvers'\n\nexport const usePoolsMutationResolvers = () => {\n    const submitTrade = useSubmitTradeMutationResolver();\n    \n    return {\n        submitTrade\n    }\n}","import { ApolloCache, NormalizedCacheObject } from '@apollo/client';\nimport BigNumber from 'bignumber.js';\nimport { gql } from 'graphql.macro';\nimport { useCallback } from 'react'\nimport { PoolType } from '../../../components/Chart/shared';\nimport { Maybe, TradeType } from '../../../generated/graphql';\nimport { useResolverToRef } from '../../accounts/resolvers/useAccountsMutationResolvers'\nimport { usePolkadotJsContext } from '../../polkadotJs/usePolkadotJs';\nimport { SubmitTradeMutationVariables } from '../mutations/useSubmitTradeMutation';\nimport { buy as buyLbp } from '../lbp/buy';\nimport { sell as sellLbp } from '../lbp/sell';\nimport { buy as buyXyk } from '../xyk/buy'\nimport { sell as sellXyk } from '../xyk/sell';\n\n// this is for buy, for sell we need to use minus, not plus\nexport const applyAllowedSlippage = (\n    amount: string, \n    allowedSlippage: string,\n    tradeType: TradeType\n) => {\n    let slippageAmount = new BigNumber(amount)\n        .multipliedBy(\n            new BigNumber(allowedSlippage)\n                .dividedBy(100)\n        )\n\n    const amountBN = new BigNumber(amount);\n    \n    const amountWithSlippage = tradeType === TradeType.Buy\n            // if you're buying an exact amount,\n            // you must be willing to pay more\n            ? amountBN.plus(slippageAmount)\n            // if you're selling an exact amount,\n            // you should be willing to receive less\n            : amountBN.minus(slippageAmount)\n    \n    return amountWithSlippage.toFixed(0);\n}\n\nexport const applyTradeFee = (\n    amount: string,\n    // TODO: get this from constants\n    tradeFee: string = '0.002', // 0.2% default\n    tradeType: TradeType\n) => {\n    let fee = new BigNumber(amount)\n        .multipliedBy(\n            new BigNumber(tradeFee)\n        )\n\n    const amountBN = new BigNumber(amount);\n    \n    const amountWithFee = tradeType === TradeType.Buy\n            ? amountBN.plus(fee)\n            : amountBN.minus(fee);\n            \n    return amountWithFee.toFixed(0);\n}\n\nexport const useSubmitTradeMutationResolver = () => {\n    const { apiInstance } = usePolkadotJsContext();\n\n    return useResolverToRef(\n        useCallback(async (\n            _obj,\n            args: Maybe<SubmitTradeMutationVariables>,\n            { cache }: { cache: ApolloCache<NormalizedCacheObject> }\n        ) => {\n            if (!args || !apiInstance) return\n            if (args?.poolType === PoolType.XYK && args?.tradeType === TradeType.Buy) {\n                return await buyXyk(\n                    cache,\n                    apiInstance,\n                    args.assetOutId,\n                    args.assetInId,\n                    args.assetOutAmount,\n                    args.amountWithSlippage,\n                );\n            }\n\n            if (args?.poolType === PoolType.XYK && args?.tradeType === TradeType.Sell) {\n                return await sellXyk(\n                    cache,\n                    apiInstance,\n                    args.assetInId,\n                    args.assetOutId,\n                    args.assetInAmount,\n                    args.amountWithSlippage,\n                );\n            }\n\n            if (args?.poolType === PoolType.LBP && args?.tradeType === TradeType.Buy) {\n                return await buyLbp(\n                    cache,\n                    apiInstance,\n                    args.assetOutId,\n                    args.assetInId,\n                    args.assetOutAmount,\n                    args.amountWithSlippage\n                )\n            }\n\n            if (args?.poolType === PoolType.LBP && args?.tradeType === TradeType.Sell) {\n                return await sellLbp(\n                    cache,\n                    apiInstance,\n                    args.assetOutId,\n                    args.assetInId,\n                    args.assetOutAmount,\n                    args.amountWithSlippage\n                )\n            }\n\n            throw new Error('We dont support this trade type yet');\n        }, [buyXyk, sellXyk, apiInstance])\n    )\n}","import { useMemo } from 'react';\nimport { ApolloClient, InMemoryCache, Resolvers } from '@apollo/client';\nimport { useAccountsQueryResolvers } from '../accounts/resolvers/useAccountsQueryResolvers';\nimport { loader } from 'graphql.macro';\nimport { useAccountsMutationResolvers } from '../accounts/resolvers/useAccountsMutationResolvers';\nimport { useRefetchWithNewBlock } from '../lastBlock/useRefetchWithNewBlock';\nimport { usePersistentConfig } from '../config/usePersistentConfig';\nimport { useVestingMutationResolvers } from '../vesting/useVestingMutationResolvers';\n\nimport { useBalanceMutationResolvers } from '../balances/useBalanceMutationResolvers';\nimport { useExtensionQueryResolvers } from '../polkadotJs/useExtensionQueryResolvers';\nimport { useConfigQueryResolvers } from '../config/useConfigQueryResolvers';\nimport { useConfigMutationResolvers } from '../config/useConfigMutationResolver';\nimport { useFeePaymentAssetsQueryResolvers } from '../feePaymentAssets/useFeePaymentAssetsQueryResolvers';\nimport { usePoolsQueryResolver } from '../pools/resolvers/usePoolsQueryResolver';\nimport { useBalanceQueryResolvers } from '../balances/useBalanceQueryResolvers';\nimport { useAssetsQueryResolvers } from '../assets/resolvers/useAssetsQueryResolvers';\nimport { usePoolsMutationResolvers } from '../pools/resolvers/usePoolsMutationResolvers';\n\n/**\n * Add all local gql resolvers here\n * @returns Resolvers\n */\nexport const useResolvers: () => Resolvers = () => {\n  const { Query: AccountsQueryResolver, Account } = useAccountsQueryResolvers();\n  const {\n    Query: PoolsQueryResolver,\n    XYKPool,\n    LBPPool,\n  } = usePoolsQueryResolver();\n  return {\n    Query: {\n      ...AccountsQueryResolver,\n      ...useExtensionQueryResolvers(),\n      ...useConfigQueryResolvers(),\n      ...useFeePaymentAssetsQueryResolvers(),\n      ...useBalanceQueryResolvers(),\n      ...PoolsQueryResolver,\n      ...useAssetsQueryResolvers(),\n    },\n    Mutation: {\n      ...useAccountsMutationResolvers(),\n      ...useVestingMutationResolvers(),\n      ...useBalanceMutationResolvers(),\n      ...useConfigMutationResolvers(),\n      ...usePoolsMutationResolvers(),\n    },\n    Account,\n    XYKPool,\n    LBPPool,\n  };\n};\n\nexport const typeDefs = loader('./../../schema.graphql');\n\n/**\n * Recreates the apollo client instance each time the config changes\n * @returns\n */\nexport const useConfigureApolloClient = () => {\n  const resolvers = useResolvers();\n  // can't get the config from a query before we setup apollo\n  // therefore we get it from the local storage instead\n  const [{ processorUrl }] = usePersistentConfig();\n\n  const client = useMemo(() => {\n    const cache = new InMemoryCache();\n\n    return new ApolloClient({\n      uri: processorUrl,\n      cache,\n      // TODO: don't connect in production\n      connectToDevTools: true,\n      queryDeduplication: true,\n      resolvers,\n      typeDefs,\n    });\n  }, [processorUrl, resolvers]);\n\n  useRefetchWithNewBlock(client);\n\n  return client;\n};\n\nexport const useApollo = () => useConfigureApolloClient();\n","import { useBalanceQueryResolvers } from '../../balances/useBalanceQueryResolvers';\nimport { useVestingScheduleQueryResolvers } from '../../vesting/useVestingScheduleQueryResolvers';\nimport { useGetAccountsQueryResolver } from './useGetAccountsQueryResolver';\n\n/**\n * Used to resolve queries for the `Account` (or `accounts`) entity.\n */\nexport const useAccountsQueryResolvers = () => {\n  const getAccountsQueryResolver = useGetAccountsQueryResolver();\n\n  return {\n    Query: {\n      accounts: getAccountsQueryResolver,\n    },\n    /**\n     * Additional sub-resolvers for the `Account` entity,\n     * resolving e.g. the `balances` or `vestingSchedules` fields.\n     */\n    Account: {\n      ...useBalanceQueryResolvers(),\n      ...useVestingScheduleQueryResolvers(),\n    },\n  };\n};\n","import { useBalanceQueryResolvers } from '../../balances/useBalanceQueryResolvers'\nimport { useGetPoolsQueryResolver } from './useGetPoolsQueryResolver'\n\nexport const usePoolsQueryResolver = () => {\n    const getPoolsQueryResolver = useGetPoolsQueryResolver()\n    const poolFieldsQueryResolvers = {\n        ...useBalanceQueryResolvers()\n    }\n\n    return {\n        Query: {\n            pools: getPoolsQueryResolver,\n        },\n        XYKPool: poolFieldsQueryResolvers,\n        LBPPool: poolFieldsQueryResolvers\n    }\n}","import { useGetAssetsQueryResolver } from './useGetAssetsQueryResolver'\n\nexport const useAssetsQueryResolvers = () => {\n    const getAssetsQueryResolver = useGetAssetsQueryResolver();\n\n    return {\n        assets: getAssetsQueryResolver\n        // TODO: add stuff like a total circulating supply or other data we might need\n        // Asset:\n    }\n}","import { useLazyQuery, useQuery } from '@apollo/client';\nimport constate from 'constate';\nimport { loader } from 'graphql.macro';\nimport { Query } from '../../generated/graphql';\n\nexport const GET_EXTENSION = loader('./graphql/GetExtension.query.graphql');\n\nexport interface GetExtensionQueryResponse {\n    extension: Query['extension']\n}\n\nexport const useGetExtensionQuery = () => useQuery<GetExtensionQueryResponse>(GET_EXTENSION, {\n    notifyOnNetworkStatusChange: true,\n});\n\nexport const useGetExtensionLazyQuery = () => useLazyQuery<GetExtensionQueryResponse>(GET_EXTENSION, {\n    notifyOnNetworkStatusChange: true\n})\n\nexport const [GetExtensionQueryProvider, useContextualGetExtensionLazyQuery] = constate(useGetExtensionLazyQuery);","import { ApolloProvider } from '@apollo/client';\nimport React from 'react';\nimport { useApollo } from '../hooks/apollo/useApollo';\nimport { LastBlockProvider } from '../hooks/lastBlock/useSubscribeNewBlockNumber';\nimport { GetExtensionQueryProvider } from '../hooks/polkadotJs/useGetExtensionQuery';\nimport { PolkadotJsProvider } from '../hooks/polkadotJs/usePolkadotJs';\nimport { MathProvider } from '../hooks/math/useMath';\n\nexport const ConfiguredApolloProvider = ({\n  children,\n}: {\n  children: React.ReactNode;\n}) => {\n  const client = useApollo();\n  return <ApolloProvider client={client}>{children}</ApolloProvider>;\n};\n\nexport const QueryProvider = ({ children }: { children: React.ReactNode }) => (\n  <GetExtensionQueryProvider>{children}</GetExtensionQueryProvider>\n);\n\n// TODO: use react-multi-provider instead of ugly nesting\nexport const MultiProvider = ({ children }: { children: React.ReactNode }) => {\n  return (\n    <PolkadotJsProvider>\n      <MathProvider>\n        <LastBlockProvider>\n          <ConfiguredApolloProvider>\n            <QueryProvider>{children}</QueryProvider>\n          </ConfiguredApolloProvider>\n        </LastBlockProvider>\n      </MathProvider>\n    </PolkadotJsProvider>\n  );\n};\n","import { useQuery } from '@apollo/client';\nimport { loader } from 'graphql.macro';\nimport { Pool } from '../../../generated/graphql';\nimport { GetPoolsQueryResponse } from './useGetPoolsQuery';\n\nexport const GET_POOL_BY_ASSETS = loader('./../graphql/GetPoolByAssets.query.graphql');\n\nexport interface GetPoolByAssetsQueryVariables {\n    assetInId?: string,\n    assetOutId?: string,\n}\nexport interface GetPoolQueryResponse {\n    pool: Pool\n}\n\nexport const useGetPoolByAssetsQuery = (variables: GetPoolByAssetsQueryVariables) => useQuery<GetPoolQueryResponse>(\n    GET_POOL_BY_ASSETS, \n    { \n        variables,\n        notifyOnNetworkStatusChange: true,\n    }\n);","import { useMemo } from 'react'\nimport { UseFormReturn } from 'react-hook-form'\n\nexport interface TokenInputProps {\n    assetIdInputProps: object,\n    assetAmountInputProps: object,\n    disabled?: boolean\n}\n\nexport const TokenInput = ({\n    assetIdInputProps,\n    assetAmountInputProps,\n    disabled\n}: TokenInputProps) => {\n    return <div>\n        <div>\n            <b>AssetId:</b> <br/>\n            <input\n                disabled={disabled}\n                type='text' \n                {...assetIdInputProps} \n            />\n        </div>\n        <div>\n            <b>Asset amount:</b> <br/>\n            <input\n                disabled={disabled}\n                type='text' \n                {...assetAmountInputProps}\n            />\n        </div>\n    </div>\n}","import BigNumber from 'bignumber.js';\nimport { useMemo } from 'react';\n\nexport const PRECISION_12 = 12;\nexport const PRECISION_18 = 18;\nexport const precision12 = new BigNumber(10).pow(PRECISION_12);\nexport const precision18 = new BigNumber(10).pow(PRECISION_18);\n\nexport const fromPrecision12 = (amount?: string | BigNumber) => (\n    amount && new BigNumber(amount)\n        .dividedBy(precision12).toFixed(PRECISION_12)\n)\nexport const useFromPrecision12 = (amount?: string | BigNumber) => (\n    useMemo(() => fromPrecision12(amount), [amount])\n)\n\nexport const useFromPrecision18 = (amount?: string | BigNumber) => (\n    useMemo(() => (\n        amount && new BigNumber(amount)\n            .dividedBy(precision18).toFixed(PRECISION_18)\n    ), [amount])\n)","import BigNumber from 'bignumber.js';\nimport { useMemo } from 'react';\nimport { PRECISION_12 } from './useFromPrecision';\n\nexport const PRECISION_0 = 0;\nexport const precision12 = new BigNumber(10).pow(12);\nexport const precision18 = new BigNumber(10).pow(18);\n\nexport const toPrecision12 = (amount?: string | BigNumber) => (\n    amount && new BigNumber(amount)\n            .multipliedBy(precision12).toFixed(PRECISION_0)\n);\nexport const useToPrecision12 = (amount?: string | BigNumber) => (\n    useMemo(() => toPrecision12(amount), [amount])\n)\n\nexport const useToPrecision18 = (amount?: string | BigNumber) => (\n    useMemo(() => (\n        amount && new BigNumber(amount)\n            .multipliedBy(precision18).toFixed(PRECISION_0)\n    ), [amount])\n)","import { useForm } from 'react-hook-form'\nimport { TradeFormProps } from '../TradeForm'\n\nexport interface TradeFormFields {\n    assetInId: string,\n    assetOutId?: string,\n    assetInAmount?: string,\n    assetOutAmount?: string,\n    allowedSlippage: string,\n    autoSlippage: boolean,\n}\n\n\n/**\n * Define fields for the TradeForm\n * @param param0 \n * @returns \n */\n export const useTradeForm = ({ assetInId, assetOutId }: TradeFormProps['assetIds']) => {\n    return useForm<TradeFormFields>({\n        defaultValues: {\n            assetInId,\n            assetOutId,\n            assetInAmount: '0',\n            assetOutAmount: '0',\n            allowedSlippage: '5',\n            autoSlippage: true,\n        }\n    })\n}","// TODO: revisit, this is very hacky, possibly a memory leak because the event handlers are not removed\n\nimport { useEffect, useState } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { TradeFormFields } from './useTradeForm';\n\n/**\n * Trigger a state update each time the given input changes (via the `input` event)\n * @param form \n * @param field \n * @returns \n */\n export const useListenForInput = (form: UseFormReturn<TradeFormFields>, field: string) => {\n    const [state, setState] = useState<boolean>(false);\n    \n    const inputRef = (form.control._fields[field] as any)?._f?.ref;\n\n    useEffect(() => {\n        if (!inputRef) return;\n        const listener = inputRef\n            ?.addEventListener('input', () => setState(state => !state));\n        \n        return () => inputRef?.removeEventListener('input', listener);\n    }, [inputRef])\n\n    return state;\n}","import { useMutation } from '@apollo/client';\nimport { loader } from 'graphql.macro';\nimport { PoolType } from '../../../components/Chart/shared';\nimport { TradeType } from '../../../generated/graphql';\n\nconst SUBMIT_TRADE = loader('./../graphql/SubmitTrade.mutation.graphql');\n\nexport interface SubmitTradeMutationVariables {\n    assetInId: string,\n    assetOutId: string,\n    assetInAmount: string,\n    assetOutAmount: string,\n    poolType: PoolType,\n    tradeType: TradeType,\n    amountWithSlippage: string\n}\n\nexport const useSubmitTradeMutation = () => useMutation<void, SubmitTradeMutationVariables>(\n    SUBMIT_TRADE, \n    {\n        notifyOnNetworkStatusChange: true\n    }\n)\n\n/**\n * lbp.buy(assetOut, assetIn, amount, maxLimit)\n * lbp.sell(assetIn, assetOut, amount, maxLimit)\n * \n * exchange.buy(assetBuy, assetSell, amountBuy, maxSold, discount)\n * exchange.sell(assetSell, assetBuy, amountSell, minBought, discount)\n */\n\n","import log from 'loglevel';\nimport { useCallback } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { PoolType } from '../../../components/Chart/shared';\nimport { TradeType } from '../../../generated/graphql';\nimport { toPrecision12 } from '../../../hooks/math/useToPrecision';\nimport { useSubmitTradeMutation } from '../../../hooks/pools/mutations/useSubmitTradeMutation';\nimport { applyAllowedSlippage } from '../../../hooks/pools/resolvers/useSubmitTradeMutationResolvers';\nimport { SpotPrice } from '../../../pages/TradePage/TradePage';\nimport { TradeFormProps } from '../TradeForm';\nimport { Slippage } from './useSlippage';\nimport { TradeFormFields } from './useTradeForm';\n\n/**\n * Submit the trade mutation once the trade form has been submitted\n * @param tradeType\n * @param pool \n * @returns \n */\n export const useHandleSubmit = (\n    tradeType: TradeType,\n    allowedSlippage: string,\n    slippage?: Slippage,\n    pool?: TradeFormProps['pool'],\n\n) => {\n    const [submitTrade] = useSubmitTradeMutation();\n    return useCallback(({\n        assetInId,\n        assetOutId,\n        assetInAmount,\n        assetOutAmount\n    }: TradeFormFields) => {\n        if (!pool) throw new Error(`Can't submit a trade mutation without a pool`);\n\n        assetInAmount = toPrecision12(assetInAmount);\n        assetOutAmount = toPrecision12(assetOutAmount);\n\n        if (!assetInId || !assetOutId || !assetInAmount || !assetOutAmount || !slippage?.spotPriceAmount) {\n            throw new Error(`Can't submit a trade mutation without all the required arguments`)\n        }\n\n        const amountWithSlippage = applyAllowedSlippage(\n            slippage?.spotPriceAmount,\n            allowedSlippage,\n            tradeType\n        );\n\n        log.debug('TradeForm.useHandleSubmit', 'amountWithSlippage', {\n            spotPriceAmount: slippage.spotPriceAmount,\n            amountWithSlippage,\n            tradeType\n        });\n\n        const poolType = pool.__typename === 'LBPPool'\n            ? PoolType.LBP\n            : PoolType.XYK\n\n        // Submit a trade with the given parameters to be handled by Apollo\n        submitTrade({ variables: {\n            tradeType,\n            assetInId,\n            assetInAmount,\n            assetOutId,\n            assetOutAmount,\n            amountWithSlippage,\n            poolType,\n        }});\n\n    }, [submitTrade, pool, tradeType, slippage]);\n}","import { find } from 'lodash';\nimport { XykPool } from '../../../generated/graphql';\nimport { HydraDxMath } from '../../math/useMath';\n\nexport const calculateOutGivenIn = (\n    math: HydraDxMath,\n    inReserve: string,\n    outReserve: string,\n    amountIn: string,\n) => math.xyk.calculate_out_given_in(inReserve, outReserve, amountIn);\n\nexport const calculateOutGivenInFromPool = (\n    math: HydraDxMath,\n    pool: XykPool,\n    assetInId: string,\n    assetOutId: string,\n    amountIn: string,\n) => {\n    const assetInBalance = find(pool.balances, { assetId: assetInId })?.balance;\n    const assetOutBalance = find(pool.balances, { assetId: assetOutId })?.balance\n\n    if (!assetInBalance || !assetOutBalance) throw new Error(`Can't find the required balances in the pool`);\n\n    return calculateOutGivenIn(math, assetInBalance, assetOutBalance, amountIn);\n}","import { find } from 'lodash';\nimport { LbpPool, Pool } from '../../../generated/graphql';\nimport { HydraDxMath } from '../../math/useMath';\n\n/**\n * Wrapper for `math.lbp.calculate_in_given_out`\n * @param math\n * @param inReserve \n * @param outReserve \n * @param inWeight \n * @param outWeight \n * @param amount \n * @returns \n */\nexport const calculateInGivenOut = (\n    math: HydraDxMath,\n    inReserve: string,\n    outReserve: string,\n    inWeight: string,\n    outWeight: string,\n    amount: string\n) => {\n    return math.lbp.calculate_in_given_out(inReserve, outReserve, inWeight, outWeight, amount);\n}\n\nexport const getPoolBalances = (pool: Pool, assetInId: string, assetOutId: string) => {\n    const assetABalance = find(pool.balances, { assetId: assetInId })?.balance;\n    const assetBBalance = find(pool.balances, { assetId: assetOutId })?.balance\n\n    return { assetABalance, assetBBalance }\n}\n\nexport const getInAndOutWeights = (pool: LbpPool, assetInId: string, assetOutId: string) => {\n    const assetInWeight = assetInId === pool.assetInId\n        ? pool.assetAWeights.current\n        : pool.assetBWeights.current\n\n    const assetOutWeight = assetOutId === pool.assetOutId\n        ? pool.assetBWeights.current\n        : pool.assetAWeights.current;\n\n    return { assetInWeight, assetOutWeight };\n}\n\nexport const calculateInGivenOutFromPool = (\n    math: HydraDxMath,\n    pool: LbpPool,\n    assetInId: string,\n    assetOutId: string,\n    amountOut: string,\n) => {\n    const { assetABalance: assetInBalance, assetBBalance: assetOutBalance } = getPoolBalances(\n        pool,\n        assetInId,\n        assetOutId,\n    )\n\n    if (!assetInBalance || !assetOutBalance) throw new Error(`Can't find the required balances in the pool`);\n\n    const { assetInWeight, assetOutWeight } = getInAndOutWeights(pool, assetInId, assetOutId);\n\n    return calculateInGivenOut(\n        math, \n        assetInBalance, \n        assetOutBalance,\n        assetInWeight,\n        assetOutWeight,\n        amountOut\n    );\n}","import { find } from 'lodash';\nimport { LbpPool } from '../../../generated/graphql';\nimport { HydraDxMath } from '../../math/useMath';\nimport { getInAndOutWeights, getPoolBalances } from './calculateInGivenOut';\n\n/**\n * Wrapper for `math.lbp.calculate_out_given_in`\n * @param math \n * @param inReserve \n * @param outReserve \n * @param inWeight \n * @param outWeight \n * @param amount \n * @returns \n */\nexport const calculateOutGivenIn = (\n    math: HydraDxMath,\n    inReserve: string,\n    outReserve: string,\n    inWeight: string,\n    outWeight: string,\n    amount: string,\n) => {\n    return math.lbp.calculate_out_given_in(inReserve, outReserve, inWeight, outWeight, amount);\n}\n\nexport const calculateOutGivenInFromPool = (\n    math: HydraDxMath,\n    pool: LbpPool,\n    assetInId: string,\n    assetOutId: string,\n    amountIn: string,\n) => {\n    const { assetABalance: assetInBalance, assetBBalance: assetOutBalance } = getPoolBalances(\n        pool,\n        assetInId,\n        assetOutId,\n    )\n\n    if (!assetInBalance || !assetOutBalance) throw new Error(`Can't find the required balances in the pool`);\n\n    const { assetInWeight, assetOutWeight } = getInAndOutWeights(pool, assetInId, assetOutId);\n\n    return calculateOutGivenIn(\n        math, \n        assetInBalance, \n        assetOutBalance,\n        assetInWeight,\n        assetOutWeight,\n        amountIn\n    );\n}","import { XykPool } from '../../../generated/graphql';\nimport { HydraDxMath } from '../../math/useMath';\nimport { getPoolBalances } from '../lbp/calculateInGivenOut';\n\nexport const calculateInGivenOut = (\n    math: HydraDxMath,\n    outReserve: string,\n    inReserve: string,\n    amountOut: string,\n) => math.xyk.calculate_in_given_out(outReserve, inReserve, amountOut);\n\nexport const calculateInGivenOutFromPool = (\n    math: HydraDxMath,\n    pool: XykPool,\n    assetInId: string,\n    assetOutId: string,\n    amountOut: string\n) => {\n    const { assetABalance: assetInBalance, assetBBalance: assetOutBalance } = getPoolBalances(\n        pool,\n        assetInId,\n        assetOutId,\n    )\n\n    if (!assetInBalance || !assetOutBalance) throw new Error(`Can't find the required balances in the pool`);\n\n    //TODO: argument order appears swapped when compared to the hydradx-math library\n    return calculateInGivenOut(math, assetInBalance, assetOutBalance, amountOut);\n}","import { Pool } from '../../generated/graphql';\n\n/**\n * Check if the given pool contains the selected assets\n * @param pool \n * @param assetInId \n * @param assetOutId \n * @returns \n */\nexport const poolHasAssets = (pool: Pool, assetInId: string, assetOutId: string) => {\n    const poolAssets = [pool.assetInId, pool.assetOutId];\n    return poolAssets.includes(assetInId) && poolAssets.includes(assetOutId);\n}","import BigNumber from 'bignumber.js'\nimport { useMemo } from 'react';\nimport { toPrecision12 } from './useToPrecision';\n\nexport const percentageChange = (a?: string | BigNumber, b?: string | BigNumber) => {\n    if (!a || !b) return;\n    \n    const aBN = new BigNumber(a);\n    const bBN = new BigNumber(b);\n\n    return (bBN.minus(aBN))\n        .dividedBy(aBN)\n}\nexport const usePercentageChange = (a?: string, b?: string) => (\n    useMemo(() => percentageChange(a, b), [{a, b}])\n)","import BigNumber from 'bignumber.js';\nimport { isNaN } from 'lodash';\nimport { useMemo } from 'react';\nimport { TradeType } from '../../../generated/graphql';\nimport { fromPrecision12 } from '../../../hooks/math/useFromPrecision';\nimport { percentageChange } from '../../../hooks/math/usePercentageChange';\nimport { toPrecision12 } from '../../../hooks/math/useToPrecision';\n\nexport interface Slippage {\n    percentualSlippage: string,\n    spotPriceAmount: string\n}\n\nexport const calculateSlippage = (\n    spotPrice: string,\n    assetInAmount: string,\n    assetOutAmount: string,\n) => {\n    const spotPriceAmount = new BigNumber(spotPrice)\n        .multipliedBy(\n            fromPrecision12(assetOutAmount)!\n        )\n        .toFixed(0);\n\n    const resultPercentageChange = percentageChange(\n        spotPriceAmount,\n        assetInAmount\n    );\n\n    if (!resultPercentageChange || resultPercentageChange.isNaN()) return;\n\n    // TODO: don't use this for every bignumber call\n    // TODO: fix edge cases for .09 decimal formatting\n    BigNumber.config({ ROUNDING_MODE: BigNumber.ROUND_UP });\n    const percentualSlippage = new BigNumber(resultPercentageChange)\n        .multipliedBy(100)\n        .abs()\n        .toFixed(10) // TODO: deal with formatting to 2 decimal places when displaying the result\n\n    const slippage: Slippage = {\n        percentualSlippage,\n        spotPriceAmount\n    }\n    return slippage\n}\n\n/**\n * Slippage is the percieved difference between\n * the given `spotPrice` and the given assetAmount`\n * \n * @param spotPrice\n * @param assetAmount \n * @returns \n */\nexport const useSlippage = (\n    tradeType: TradeType,\n    spotPrice?: {\n        aToB?: string,\n        bToA?: string\n    },\n    assetInAmount?: string,\n    assetOutAmount?: string,\n) => {\n    if (!spotPrice?.aToB || !spotPrice?.bToA || !assetInAmount || !assetOutAmount) return;\n    return calculateSlippage.apply(null,\n        tradeType === TradeType.Buy\n            ? [spotPrice.bToA, assetInAmount, assetOutAmount]\n            : [spotPrice.aToB, assetOutAmount, assetInAmount]\n    )\n}","import { Fee } from './generated/graphql';\n\nexport default {\n    appName: 'basilisk-ui',\n    xykFee: {\n        numerator: '2',\n        denominator: '1000'\n    } as Fee\n}","import BigNumber from 'bignumber.js';\nimport { Fee, LbpPool, Pool } from '../../../generated/graphql';\nimport constants from './../../../constants';\n\nexport const feeToPercentage = (fee: Fee) => {\n    return new BigNumber(fee.numerator)\n        .dividedBy(fee.denominator)\n        .multipliedBy('100')\n        .toFixed(2);\n}\n\nexport const feeFromPool = (pool?: Pool): Fee | undefined => {\n    return pool\n        ? (\n            pool.__typename === 'XYKPool'\n                ? constants.xykFee\n                : (pool as LbpPool).fee\n        ) : undefined\n}\n\nexport const usePercentageFee = (pool?: Pool) => {\n    const fee = feeFromPool(pool);\n    if (!fee) return;\n    return feeToPercentage(fee);\n} ","import { useEffect, useMemo } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { Fee, LbpPool, Pool } from '../../../generated/graphql';\nimport { TradeFormFields } from './useTradeForm';\nimport BigNumber from 'bignumber.js';\nimport log from 'loglevel';\nimport { feeFromPool, feeToPercentage } from './usePercentageFee';\n\nexport const defaultAllowedSlippage = {\n    xyk: '5',\n    lbp: '5'\n}\n\nexport const addFeeToSlippage = (slippage: string, fee?: Fee) => {\n    if (!fee) return slippage;\n    \n    return new BigNumber(slippage).plus(\n        feeToPercentage(fee)\n    ).toFixed(2);\n}\n\nexport const useCalculateAllowedSlippage = (\n    form: UseFormReturn<TradeFormFields>,\n    pool?: Pool,\n) => {\n    const watchAutoSlippage = form.watch('autoSlippage');\n    const allowedSlippageInputDisabled = useMemo(() => (\n        form.getValues('autoSlippage')\n    ), [watchAutoSlippage]);\n\n    useEffect(() => {\n        if (!allowedSlippageInputDisabled) return;\n\n        // TODO: depending on if the LBP repay fee is applied,\n        // increase the lbp default slippage\n        const allowedSlippage = pool\n            ? (\n                pool?.__typename === 'XYKPool'\n                ? defaultAllowedSlippage.xyk\n                : defaultAllowedSlippage.lbp\n            ) : defaultAllowedSlippage.xyk;\n\n        const allowedSlippageWithFee = addFeeToSlippage(\n            allowedSlippage,\n            feeFromPool(pool)\n        )\n\n        log.debug('TradeForm.useCalculateAllowedSlippage', 'allowedSlippageWithFee', allowedSlippageWithFee);\n\n        form.setValue('allowedSlippage', allowedSlippageWithFee);\n    }, [pool, allowedSlippageInputDisabled])\n\n    return { allowedSlippageInputDisabled };\n}","import log from 'loglevel'\nimport { useCallback, useEffect, useMemo, useState } from 'react'\nimport { useForm, UseFormReturn } from 'react-hook-form'\nimport { usePreviousDistinct } from 'react-use'\nimport { PoolType } from '../../components/Chart/shared'\nimport { TokenInput } from '../../components/Input/TokenInput'\nimport { Pool, TradeType } from '../../generated/graphql'\nimport { useSubmitTradeMutation } from '../../hooks/pools/mutations/useSubmitTradeMutation'\nimport { calculateOutGivenInFromPool as calculateOutGivenInFromPoolXYK } from '../../hooks/pools/xyk/calculateOutGivenIn'\nimport { calculateOutGivenInFromPool as calculateOutGivenInFromPoolLBP } from '../../hooks/pools/lbp/calculateOutGivenIn'\nimport { useMathContext } from '../../hooks/math/useMath'\nimport { fromPrecision12 } from '../../hooks/math/useFromPrecision'\nimport { toPrecision12 } from '../../hooks/math/useToPrecision'\nimport { calculateInGivenOutFromPool as calculateInGivenOutFromPoolLBP } from '../../hooks/pools/lbp/calculateInGivenOut'\nimport { calculateInGivenOutFromPool as calculateInGivenOutFromPoolXYK } from '../../hooks/pools/xyk/calculateInGivenOut'\nimport { SpotPrice } from '../../pages/TradePage/TradePage'\nimport { useTradeForm } from './hooks/useTradeForm'\nimport { useListenForInput } from './hooks/useListenForInput'\nimport { useTradeType } from './hooks/useTradeType'\nimport { useHandleAssetIdsChange } from './hooks/useHandleAssetIdsChange'\nimport { useHandleSubmit } from './hooks/useHandleSubmit';\nimport { poolHasAssets } from '../../hooks/pools/poolHasAssets'\nimport { useCalculateInAndOut } from './hooks/useCalculateInAndOut'\nimport { useSlippage } from './hooks/useSlippage'\nimport { isEqual } from 'lodash'\nimport { useResetAmountInputsOnPoolChange } from './hooks/useResetAmountInputsOnPoolChange'\nimport { useCalculateAllowedSlippage } from './hooks/useCalculateAllowedSlippage'\nimport { usePercentageFee } from './hooks/usePercentageFee'\n\nexport interface TradeFormProps {\n    pool?: Pool,\n    loading: boolean,\n    assetIds: {\n        assetInId: string,\n        assetOutId?: string\n    },\n    spotPrice?: SpotPrice,\n    onAssetIdsChange: (assetInId: string, assetOutId?: string) => void\n}\n\nexport const TradeForm = ({\n    pool,\n    loading,\n    onAssetIdsChange,\n    assetIds,\n    spotPrice\n}: TradeFormProps) => {\n    const form = useTradeForm(assetIds);\n    const fee = usePercentageFee(pool);\n    const tradeType = useTradeType(form);\n    useHandleAssetIdsChange(form, onAssetIdsChange);\n    useCalculateInAndOut(form, tradeType, pool);\n    useResetAmountInputsOnPoolChange(form, pool);\n\n    // TODO: adjust the precision in the hook itself?\n    const slippage = useSlippage(tradeType, spotPrice, \n        toPrecision12(form.getValues('assetInAmount')),\n        toPrecision12(form.getValues('assetOutAmount'))\n    );\n\n    const handleSubmit = useHandleSubmit(\n        tradeType, \n        form.getValues('allowedSlippage'), \n        slippage, \n        pool\n    );\n\n    const { allowedSlippageInputDisabled } = useCalculateAllowedSlippage(form, pool);\n\n    return <div>\n        <form onSubmit={form.handleSubmit(handleSubmit)}>\n            <p>{tradeType}</p>\n            <TokenInput\n                assetIdInputProps={form.register('assetInId')}\n                assetAmountInputProps={form.register('assetInAmount')}\n            />\n\n            <br/>\n\n            <TokenInput\n                assetIdInputProps={form.register('assetOutId')}\n                assetAmountInputProps={form.register('assetOutAmount')}\n            />\n\n            <div>\n                <b>Allowed slippage</b><br/>\n                <input \n                    type=\"text\"\n                    disabled={allowedSlippageInputDisabled}\n                    {...form.register('allowedSlippage')}\n                />\n                <br/>\n                <b>Auto slippage</b> \n                <input type=\"checkbox\" {...form.register('autoSlippage')}/>\n            </div>\n\n            <br/>\n\n            <p>\n                <b>Slippage:</b> {slippage?.percentualSlippage} / {fromPrecision12(slippage?.spotPriceAmount)}\n            </p>\n            <p>\n                <b>Fee:</b> {fee}%\n            </p>\n\n            <button\n                disabled={loading}\n                type='submit'\n            >\n                Trade\n            </button>\n        </form>\n    </div>\n}","import log from 'loglevel';\nimport { useState, useEffect } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { TradeType } from '../../../generated/graphql';\nimport { useListenForInput } from './useListenForInput';\nimport { TradeFormFields } from './useTradeForm';\n\n/**\n * Listen to changes to inputs within the trade form, and set the trade type\n * according to which input field has been interacted with last\n * @param form \n * @returns \n */\n export const useTradeType = (form: UseFormReturn<TradeFormFields>) => {\n    const [tradeType, setTradeType] = useState<TradeType>(TradeType.Sell);\n    \n    const watchassetInAmount = useListenForInput(form, 'assetInAmount');\n    const watchAassetInId = useListenForInput(form, 'assetInId');\n\n    const watchAassetOutAmount = useListenForInput(form, 'assetOutAmount');\n    const watchAassetOutId = useListenForInput(form, 'assetOutId');\n\n    useEffect(() => { \n        log.debug('TradeForm.setTradeType', TradeType.Sell)\n        setTradeType(TradeType.Sell) \n    }, [watchassetInAmount, watchAassetInId]);\n\n    useEffect(() => {\n        log.debug('TradeForm.setTradeType', TradeType.Buy)\n        setTradeType(TradeType.Buy) \n    }, [watchAassetOutAmount, watchAassetOutId]);\n\n    return tradeType;\n}","import log from 'loglevel';\nimport { useEffect } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { TradeFormProps } from '../TradeForm';\nimport { TradeFormFields } from './useTradeForm';\n\n/**\n * Inform parent components about asset ID changes in the form\n * @param form \n * @param onAssetIdsChange \n */\n export const useHandleAssetIdsChange = (\n    form: UseFormReturn<TradeFormFields>,\n    onAssetIdsChange: TradeFormProps['onAssetIdsChange']\n) => {\n    const [assetInId, assetOutId] = form.watch(['assetInId', 'assetOutId']);\n    useEffect(() => {\n        log.debug('TradeForm.useHandleAssetIdsChange', assetInId, assetOutId);\n        onAssetIdsChange(assetInId, assetOutId);\n    }, [assetInId, assetOutId]);\n}","import { useMemo, useEffect } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { Pool, TradeType } from '../../../generated/graphql';\nimport { useMathContext } from '../../../hooks/math/useMath';\nimport { toPrecision12 } from '../../../hooks/math/useToPrecision';\nimport { calculateOutGivenInFromPool as calculateOutGivenInFromPoolXYK } from '../../../hooks/pools/xyk/calculateOutGivenIn';\nimport { calculateOutGivenInFromPool as calculateOutGivenInFromPoolLBP } from '../../../hooks/pools/lbp/calculateOutGivenIn';\nimport { calculateInGivenOutFromPool as calculateInGivenOutFromPoolXYK } from '../../../hooks/pools/xyk/calculateInGivenOut';\nimport { calculateInGivenOutFromPool as calculateInGivenOutFromPoolLBP } from '../../../hooks/pools/lbp/calculateInGivenOut';\nimport { poolHasAssets } from '../../../hooks/pools/poolHasAssets';\nimport { fromPrecision12 } from '../../../hooks/math/useFromPrecision';\nimport log from 'loglevel';\nimport { TradeFormFields } from './useTradeForm';\n\n// TODO: loading state when calculating the fee\n/**\n * Calculate in/out amounts respectively for both XYK & LBP\n * @param form \n * @param tradeType \n * @param pool \n */\n export const useCalculateInAndOut = (\n    form: UseFormReturn<TradeFormFields>,\n    tradeType: TradeType,\n    pool?: Pool\n) => {\n    const { math } = useMathContext();\n    let [assetInId, assetInAmount] = form.watch(['assetInId', 'assetInAmount']);\n    let [assetOutId, assetOutAmount] = form.watch(['assetOutId', 'assetOutAmount']);\n    \n    // convert the user input to the required precision\n    assetInAmount = toPrecision12(assetInAmount);\n    assetOutAmount = toPrecision12(assetOutAmount);\n\n    const calculateOutGivenIn = useMemo(() => (\n        pool?.__typename === 'XYKPool'\n            ? calculateOutGivenInFromPoolXYK\n            : calculateOutGivenInFromPoolLBP\n    ), [pool])\n\n    const calculateInGivenOut = useMemo(() => (\n        pool?.__typename === 'XYKPool'\n            ? calculateInGivenOutFromPoolXYK\n            : calculateInGivenOutFromPoolLBP\n    ), [pool]);\n    \n    useEffect(() => {\n        if (!pool || !math || !assetOutId || !assetInAmount) return;\n        if (!poolHasAssets(pool, assetInId, assetOutId)) return;\n        if (tradeType !== TradeType.Sell) return;\n\n        const outAmount = calculateOutGivenIn(\n            math, \n            pool as any, \n            assetInId, \n            assetOutId, \n            assetInAmount\n        )\n        \n        /**\n         * if LBP && assetOut == accumulated asset then \n         * apply fee on top of outAmount\n         */\n\n        log.debug('TradeForm.useCalculateInAndOut', 'outAmount', outAmount);\n\n        form.setValue('assetOutAmount', fromPrecision12(outAmount));\n    }, [assetInAmount, assetInId, assetOutId, tradeType, pool])\n\n    useEffect(() => {\n        if (!pool || !math || !assetOutId || !assetOutAmount) return;\n        if (!poolHasAssets(pool, assetInId, assetOutId)) return;\n        if (tradeType !== TradeType.Buy) return;\n\n        // TODO: when LBP & assetOut === accumulated asset\n        // then calculateFee with assetOutAmount\n\n        /**\n         * when the case above happens, your trade happens at a worse spot price\n         * and the pool pays the repayFee on your behalf\n         */\n\n        const inAmount = calculateInGivenOut(\n            math, \n            pool as any, \n            assetInId, \n            assetOutId, \n            // difference between calc (assetOut+fee) and calc(assetOut) is the absolute fee\n            assetOutAmount //TODO: use assetOutAmount + fee\n        );\n        \n        log.debug('TradeForm.useCalculateInAndOut', 'inAmount', fromPrecision12(inAmount));\n\n        form.setValue('assetInAmount', fromPrecision12(inAmount));\n    }, [assetOutAmount, assetInId, assetOutId, tradeType, pool])\n}","import { isEqual } from 'lodash';\nimport { useEffect } from 'react';\nimport { UseFormReturn } from 'react-hook-form';\nimport { usePreviousDistinct } from 'react-use';\nimport { Pool } from '../../../generated/graphql';\nimport { TradeFormFields } from './useTradeForm';\n\nexport const useResetAmountInputsOnPoolChange = (\n    form: UseFormReturn<TradeFormFields>,\n    pool?: Pool\n) => {\n    const previousPoolId = usePreviousDistinct(pool?.id);\n    useEffect(() => {\n        if (!isEqual(previousPoolId, pool?.id)) {\n            form.resetField('assetInAmount');\n            form.resetField('assetOutAmount');\n        }\n    }, [previousPoolId, pool?.id])\n}","import { fromPrecision12 } from '../hooks/math/useFromPrecision'\nimport { SpotPrice } from '../pages/TradePage/TradePage'\n\nexport interface PoolLiquidity {\n    assetABalance?: string,\n    assetBBalance?: string,\n}\nexport interface TradeChartProps {\n    spotPrice?: SpotPrice,\n    poolLiquidity: PoolLiquidity\n}\nexport const TradeChart = ({ spotPrice, poolLiquidity }: TradeChartProps) => {\n    return <div>\n        <p>TradeChart</p>\n        <div>\n            <b>Spot price</b><br/>\n            <span>1 A = {fromPrecision12(spotPrice?.aToB)}B</span><br/>\n            <span>1 B = {fromPrecision12(spotPrice?.bToA)}A</span>\n            \n            <br/><br/>\n\n            <b>Pool liquidity</b><br/>\n            <span>A = {fromPrecision12(poolLiquidity.assetABalance)}</span><br/>\n            <span>B = {fromPrecision12(poolLiquidity.assetBBalance)}</span>\n\n            <br/><br/>\n        </div>\n    </div>\n}","import { find } from 'lodash';\nimport { useMemo } from 'react';\nimport { LbpPool } from '../../../generated/graphql';\nimport { HydraDxMath, useMathContext } from '../../math/useMath';\n\nexport const oneWithPrecision = '1000000000000'; // 10^12 doesnt work, use 10^9 instead\n\nexport const calculateSpotPrice = (\n    math: HydraDxMath,\n    inReserve: string,\n    outReserve: string,\n    inWeight: string,\n    outWeight: string,\n    amount: string = oneWithPrecision,\n) => math.lbp.get_spot_price(inReserve, outReserve, inWeight, outWeight, amount);\n\nexport const calculateSpotPriceFromPool = (\n    math: HydraDxMath,\n    pool: LbpPool,\n    assetInId: string,\n    assetOutId: string,\n) => {\n    const assetInBalance = find(pool.balances, { assetId: assetInId })?.balance;\n    const assetOutBalance = find(pool.balances, { assetId: assetOutId })?.balance\n\n    if (!assetInBalance || !assetOutBalance) throw new Error(`Can't find the required balances in the pool`);\n\n    const assetInWeight = assetInId === pool.assetInId\n        ? pool.assetAWeights.current\n        : pool.assetBWeights.current\n\n    const assetOutWeight = assetOutId === pool.assetOutId\n        ? pool.assetBWeights.current\n        : pool.assetAWeights.current;\n\n    return calculateSpotPrice(\n        math, \n        assetInBalance, \n        assetOutBalance,\n        assetInWeight,\n        assetOutWeight,\n    );\n}\n","import { find } from 'lodash';\nimport { XykPool } from '../../../generated/graphql';\nimport { HydraDxMath } from '../../math/useMath';\nimport { oneWithPrecision } from '../lbp/calculateSpotPrice';\n\nexport const calculateSpotPrice = (\n    math: HydraDxMath,\n    inReserve: string,\n    outReserve: string,\n) => math.xyk.get_spot_price(inReserve, outReserve, oneWithPrecision);\n\nexport const calculateSpotPriceFromPool = (\n    math: HydraDxMath,\n    pool: XykPool,\n    assetInId: string,\n    assetOutId: string,\n) => {\n    const assetInBalance = find(pool.balances, { assetId: assetInId })?.balance;\n    const assetOutBalance = find(pool.balances, { assetId: assetOutId })?.balance\n\n    if (!assetInBalance || !assetOutBalance) return;\n\n    return calculateSpotPrice(\n        math,\n        assetInBalance,\n        assetOutBalance\n    )\n}","import { find, isEqual } from 'lodash';\nimport { useMemo, useState } from 'react';\nimport { useGetPoolByAssetsQuery } from '../../hooks/pools/queries/useGetPoolByAssetsQuery';\nimport { TradeForm, TradeFormProps } from '../../containers/TradeForm/TradeForm';\nimport { PoolLiquidity, TradeChart } from '../../containers/TradeChart';\nimport log from 'loglevel';\nimport { useSpotPrice } from './hooks/useSpotPrice';\nimport { usePreviousDistinct } from 'react-use';\nimport { Pool } from '../../generated/graphql';\n\nexport interface SpotPrice {\n    aToB?: string,\n    bToA?: string\n}\n\n/**\n * Trade page responsible for fetching pool data\n * @returns \n */\nexport const TradePage = () => {\n    // TODO default values here should come from the router where query args are parsed\n    const [assetIds, setAssetIds] = useState<TradeFormProps['assetIds']>({\n        assetInId: '0',\n        assetOutId: '2'\n    })\n\n    // automatically fetch a pool by the given assets\n    const { \n        data: poolData, \n        loading: poolLoading, \n        error: poolError \n    } = useGetPoolByAssetsQuery(assetIds);\n    log.debug('TradePage.useGetPoolByAssetsQuery', assetIds);\n\n    const pool: Pool | undefined = useMemo(() => poolData?.pool, [poolData?.pool]);\n\n    // if there was a problem fetching the pool, log it\n    poolError && log.error(poolError);\n\n    // combined loading state from all the required queries\n    const loading = useMemo(() => {\n        const loading = poolLoading;\n        log.debug('TradePage.loading', loading);\n        return loading;\n    }, [poolLoading]);\n\n    log.debug('TradePage.poolData.pool', poolData?.pool);\n\n    // when the underlying form's assetIds change, update the state\n    const handleAssetIdsChange = (assetInId: string, assetOutId?: string) => {\n        const newIds = { assetInId, assetOutId };\n        log.debug('TradePage.handleAssetIdsChange', isEqual(assetIds, newIds), newIds);\n        if (!isEqual(assetIds, newIds)) setAssetIds(newIds);\n    }\n\n    const spotPrice = useSpotPrice(\n        assetIds,\n        poolData?.pool\n    );\n\n    const poolLiquidity: PoolLiquidity = useMemo(() => {\n        return {\n            assetABalance: find(pool?.balances, { assetId: assetIds.assetInId })?.balance,\n            assetBBalance: find(pool?.balances, { assetId: assetIds.assetOutId })?.balance,\n        }\n    }, [pool]);\n\n    return <div>\n        <h1>Trade</h1>\n\n        <br /><br />\n\n        <TradeChart\n            poolLiquidity={poolLiquidity}\n            spotPrice={spotPrice}\n        />\n        \n        <TradeForm\n            onAssetIdsChange={handleAssetIdsChange}\n            assetIds={assetIds}\n            loading={loading}\n            pool={pool}\n            spotPrice={spotPrice}\n        />\n    </div>\n}","import { useApolloClient } from '@apollo/client';\nimport { useMemo } from 'react';\nimport { TradeFormProps } from '../../../containers/TradeForm/TradeForm';\nimport { Pool } from '../../../generated/graphql';\nimport { readLastBlock } from '../../../hooks/lastBlock/readLastBlock';\nimport { useMathContext } from '../../../hooks/math/useMath';\nimport { SpotPrice } from '../TradePage';\nimport { calculateSpotPriceFromPool as calculateSpotPriceFromPoolLBP } from '../../../hooks/pools/lbp/calculateSpotPrice';\nimport { calculateSpotPriceFromPool as calculateSpotPriceFromPoolXYK } from '../../../hooks/pools/xyk/calculateSpotPrice';\nimport log from 'loglevel';\n\nexport const useSpotPrice = (\n    { assetInId, assetOutId }: TradeFormProps['assetIds'],\n    pool?: Pool,\n): SpotPrice | undefined => {\n    const client = useApolloClient();\n    const relaychainBlockNumber = readLastBlock(client);\n    const { math } = useMathContext();\n   \n    return useMemo(() => {\n        if (!math || !pool || !assetInId || !assetOutId || !relaychainBlockNumber) return;\n\n        // if the pool is an XYKPool, use the XYKPool spot price calculation and vice versa\n        const calculateSpotPriceFromPool = pool?.__typename === 'XYKPool'\n            ? calculateSpotPriceFromPoolXYK\n            : calculateSpotPriceFromPoolLBP\n\n        const spotPrice: SpotPrice = {\n            // TODO: get rid of `as any` since its not type safe *at all*\n            aToB: calculateSpotPriceFromPool(math, pool as any, assetInId, assetOutId),\n            bToA: calculateSpotPriceFromPool(math, pool as any, assetOutId, assetInId)\n        }\n\n        log.debug('TradePage.useSpotPrice', spotPrice);\n\n        return spotPrice;\n    }, [relaychainBlockNumber, assetInId, assetOutId, pool]);\n}","import { useMutation } from '@apollo/client';\nimport { loader } from 'graphql.macro';\nimport { GET_ACTIVE_ACCOUNT } from '../queries/useGetActiveAccountQuery';\n\nexport const SET_ACTIVE_ACCOUNT = loader('./../graphql/SetActiveAccount.mutation.graphql');\n\nexport interface SetActiveAccountMutationVariables {\n    id: string | undefined\n}\n\nexport const useSetActiveAccountMutation = (variables: SetActiveAccountMutationVariables) => useMutation<void, SetActiveAccountMutationVariables>(\n    SET_ACTIVE_ACCOUNT,\n    {\n        variables,\n        refetchQueries: [\n            // TODO: figure out why do we need to refetch active account manually,\n            // while all accounts query gets updated automatically\n            GET_ACTIVE_ACCOUNT\n        ]\n    }\n)","import { useMemo } from 'react';\nimport { Account as AccountModel } from '../generated/graphql';\nimport { useSetActiveAccountMutation } from '../hooks/accounts/mutations/useSetActiveAccountMutation';\nimport { useGetAccountsQuery } from '../hooks/accounts/queries/useGetAccountsQuery'\nimport { useGetExtensionQuery } from '../hooks/polkadotJs/useGetExtensionQuery';\n\nexport const Account = ({ account }: { account?: AccountModel }) => {\n    // TODO: you can get the loading state of the mutation here as well\n    // but it probably needs to be turned into a contextual mutation\n    // in order to share the loading state accross multiple mutation hook calls\n    const [setActiveAccount] = useSetActiveAccountMutation({\n        id: account?.id\n    });\n\n    const [unsetActiveAccount] = useSetActiveAccountMutation({\n        id: undefined\n    });\n\n    return (\n        <div style={{\n            marginBottom: '24px',\n            padding: '12px',\n            paddingLeft: 0\n        }}>\n            <h3>\n                {account?.name}\n                {account?.isActive\n                    ? ' [active]'\n                    : <></>\n                }\n            </h3>\n            <p>\n                <b>Address:</b>\n                {account?.id}\n            </p>\n            <div>\n                <b>Balances:</b>\n                {account?.balances.map((balance, i) => (\n                    <p key={i}>\n                        {balance.assetId}:\n                        <i> {balance.balance}</i>\n                    </p>\n                ))}\n            </div>\n            <button\n                onClick={_ => account?.isActive ? unsetActiveAccount() : setActiveAccount()}\n            >\n                {account?.isActive ? 'Unset active' : 'Set active'}\n            </button>\n        </div>\n    )\n}\n\nexport const WalletPage = () => {\n    const { data: accountsData, loading: accountsLoading } = useGetAccountsQuery();\n    const { data: extensionData, loading: extensionLoading } = useGetExtensionQuery();\n\n    const loading = useMemo(() => {\n        return accountsLoading || extensionLoading;\n    }, [accountsLoading, extensionLoading])\n\n    return <div style={{\n        textAlign: 'left'\n    }}>\n        <h1>Accounts</h1>\n\n        {loading\n            ? <i>[WalletPage] Loading accounts...</i>\n            : <i>[WalletPage] Everything is up to date</i>\n        }\n\n        <br /><br />\n\n        {extensionData?.extension.isAvailable\n            ? (\n                <div>\n                    {accountsData?.accounts?.map((account, i) => (\n                        <Account\n                            key={i}\n                            account={account}\n                        />\n                    ))}\n                </div>\n            )\n            : <p>Extension unavailable</p>\n        }\n    </div>\n}","import { Routes, Route, Navigate } from 'react-router-dom';\nimport { TradePage } from '../pages/TradePage/TradePage';\nimport { WalletPage } from '../pages/WalletPage';\n\nexport const Router = () => {\n    return (\n        <Routes>\n            <Route path='/' element={<TradePage />} />\n            <Route path='wallet' element={<WalletPage />} />\n            <Route path=\"*\" element={<Navigate to='/'/>}/>\n        </Routes>\n    )\n}","import './ActionBar.scss';\nimport { Link } from 'react-router-dom';\n\nexport interface ActionBarProps {\n    isExtensionAvailable: boolean;\n  extensionLoading: boolean;\n  activeAccountLoading: boolean;\n  accountData?: {\n          name?: string;\n          address?: string;\n          nativeAssetBalance?: string;\n  };\n}\n\nexport const ActionBar = ({\n  extensionLoading,\n  activeAccountLoading,\n  accountData,\n  isExtensionAvailable,\n}: ActionBarProps) => {\n  return (\n    <div className=\"action-bar\">\n      <div className='action-bar-icons action-bar-item'>\n        <div className=\"action-bar-help action-bar-icon \">?</div>\n        <div className=\"action-bar-notifications action-bar-icon \">!</div>\n      </div>\n      <div>\n        {extensionLoading || activeAccountLoading ? (\n          <div className='action-bar-error action-bar-item'>loading...</div>\n        ) : isExtensionAvailable ? (\n          <>\n            {accountData?.name ? (\n                <div className='action-bar-account-info action-bar-item'>\n                    <div className='action-bar-account-balance action-bar-account-item'>\n                        {accountData?.nativeAssetBalance} BSX\n                    </div>\n                    {/* TODO! Acc name / address + Icon component*/}\n                    <div className='action-bar-account-name action-bar-account-item'>\n                        {accountData?.name}\n                    </div>\n                </div>\n            ) : (\n              <Link className='action-bar-select-account action-bar-item' to=\"/wallet\">select an account</Link>\n            )}\n          </>\n        ) : (\n          <div className='action-bar-error action-bar-item'>Extension unavailable</div>\n        )}\n      </div>\n      <div className='action-bar-settings action-bar-item'>v</div>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport './Navigation.scss';\nimport { Link} from 'react-router-dom';\n\nexport const Modal = ({ children }: { children: React.ReactNode }) => {\n  return (\n    <div>\n      <h1>modal</h1>\n      {children}\n      <button>click me</button>\n    </div>\n  );\n};\n\nexport const ConfigModal = () => <h1>Config</h1>;\n\nexport const useModal = (content: React.ReactNode) => {\n  const [show, setShow] = useState<boolean>(false);\n\n  return {\n    modal: show ? <Modal>{content}</Modal> : <></>,\n    toggleModal: () => setShow((show) => !show),\n  };\n};\n\nexport const Navigation = () => (\n  <div>\n    <Link className= 'basilisk-logo' to=\"https://bsx.fi\">()</Link>\n    <Link to=\"/\">Trade</Link>\n    {' | '}\n    <Link to=\"/\">Pools</Link>\n    {' | '}\n    <Link to=\"/wallet\">Wallet</Link>\n  </div>\n);\n\nexport const NavigationContainer = () => {\n  return <Navigation />;\n};\n","import { SI_PREFIXES } from '@gapit/format-si';\nimport BigNumber from 'bignumber.js';\nimport log from 'loglevel';\nimport { toPrecision12 } from '../../hooks/math/useToPrecision';\n\n// Used to select in what format should the given unit be displayed\nexport enum UnitStyle {\n    LONG = 'LONG',\n    SHORT = 'SHORT'\n}\n\n// TODO: offer only a constrained range of units\nexport enum MetricUnit {\n    // Y = 'Y',\n    // Z = 'Z',\n    // E = 'E',\n    // P = 'P',\n    T = 'T',\n    G = 'G',\n    M = 'M',\n    k = 'k',\n    NONE = '',\n    m = 'm',\n     = '',\n    n = 'n',\n    p = 'p',\n    // TODO: we should not allow anything below 'p' = 1e-12\n    // f = 'f',\n    // a = 'a',\n    // z = 'z',\n    // y = 'y'\n}\n\n// Mapping between short/long metric unit names\nexport type MetricUnitMap = Record<MetricUnit, string>;\nexport const unitMap: MetricUnitMap = {\n    'T': 'tera',\n    'G': 'giga',\n    'M': 'mega',\n    'k': 'kilo',\n    '': 'unit',\n    'm': 'mili',\n    '': 'micro',\n    'n': 'nano',\n    'p': 'pico'\n}\n\n// Mapping used to retrieve the base10 multiplier by the short metric unit name\nexport const prefixMap: { [key in MetricUnit]?: number } = SI_PREFIXES.reduce((prefixes, prefix) => {\n    const key = prefix.metricPrefix;\n    return {\n        ...prefixes,\n        [key]: prefix.base10\n    };\n}, {});\n\n// convert a number to a baseline value given its metric unit\nexport const formatFromSIWithPrecision12 = (number: string, metricPrefix: MetricUnit) => {\n    const base10 = prefixMap[metricPrefix];\n    log.debug('formatFromSIWithPrecision12', 'base10', base10, metricPrefix);\n    if (!base10) return;\n\n    const formattedResult = new BigNumber(number)\n        .multipliedBy(base10)\n\n    if (!formattedResult.isNaN()) return toPrecision12(formattedResult);\n}","import { Balance } from '../../../generated/graphql';\nimport { fromPrecision12 } from '../../../hooks/math/useFromPrecision';\nimport { formatPrecisionSI, formatFixedSI, SI_PREFIXES } from '@gapit/format-si';\nimport { useMemo } from 'react';\nimport log from 'loglevel';\nimport './FormattedBalance.scss';\nimport BigNumber from 'bignumber.js';\nimport { prefix } from '@fortawesome/free-solid-svg-icons';\nimport { toPrecision12 } from '../../../hooks/math/useToPrecision';\nimport { MetricUnit, unitMap, UnitStyle } from '../metricUnit';\nimport { useFormatSI } from './hooks/useFormatSI';\n\n// TODO: extract\nexport const assetIdNameMap: Record<string, { symbol: string, fullName: string }> = {\n    '0': {\n        symbol: 'BSX',\n        fullName: 'Basilisk'\n    }\n}\n\nexport interface FormattedBalanceProps {\n    balance: Balance,\n    precision?: number,\n    unitStyle: UnitStyle\n}\n\nexport const FormattedBalance = ({ \n    balance,\n    precision = 3,\n    unitStyle = UnitStyle.LONG\n}: FormattedBalanceProps) => {\n    const assetSymbol = useMemo(() => \n        assetIdNameMap[balance.assetId]?.symbol, \n        [balance.assetId]\n    );\n    const formattedBalance = useFormatSI(\n        precision, \n        unitStyle,\n        balance.balance,\n    );\n    \n    log.debug('FormattedBalance', formattedBalance?.value, formattedBalance?.unit, formattedBalance?.numberOfDecimalPlaces);\n\n    // We don't need to use the currency input here\n    // because when there is more than 3 significant digits, the formatter\n    // moves one notch up/down and keeps a fixed precision\n    return <div className='formatted-balance flex-container'>\n        <div className='formatted-balance__value'>{formattedBalance.value}</div>\n        <div className={`formatted-balance__suffix ${unitStyle.toLowerCase()}`}>{formattedBalance.suffix}</div>\n        <div className='formatted-balance__symbol'>{assetSymbol}</div>\n    </div>\n};","import { formatFixedSI } from '@gapit/format-si';\nimport { useMemo } from 'react';\nimport { fromPrecision12 } from '../../../../hooks/math/useFromPrecision';\nimport { MetricUnit, unitMap, UnitStyle } from '../../metricUnit';\n\nexport const useFormatSI = (\n    precision: number, \n    unitStyle: UnitStyle,\n    number?: string,\n) => {\n    const formattedBalance = useMemo(() => {\n        const balanceWithPrecision12 = fromPrecision12(number);\n        if (!balanceWithPrecision12) return;\n\n        // alternatively use formatPrecisionSI\n        let siFormat = formatFixedSI(\n            balanceWithPrecision12,\n            '',\n            precision\n        );\n\n        // TODO: get rid of the 'as' call\n        const unitName: string | undefined = unitMap[siFormat.unit as MetricUnit];\n\n        return {\n            ...siFormat,\n            unitName\n        }\n    }, [number, precision])\n\n    const numberOfDecimalPlaces = useMemo(() => (\n        formattedBalance?.value?.split('.')[1]?.length\n    ), [formattedBalance]);\n\n    const suffix = useMemo(() => {\n        if (!formattedBalance) return;\n\n        const unit = formattedBalance.unit;\n        const unitName = unit === '' ? '' : formattedBalance.unitName;\n        const displayUnit = unitStyle === UnitStyle.LONG\n            ? unitName || unit\n            : unit\n\n        return ` ${displayUnit}`;\n    }, [formattedBalance, unitStyle])\n\n    return { ...formattedBalance, numberOfDecimalPlaces, suffix };\n}","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgHelpIcon(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 28,\n    height: 28,\n    viewBox: \"0 0 28 28\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M14 0.4375C6.51016 0.4375 0.4375 6.51235 0.4375 14C0.4375 21.492 6.51016 27.5625 14 27.5625C21.4898 27.5625 27.5625 21.492 27.5625 14C27.5625 6.51235 21.4898 0.4375 14 0.4375ZM14 24.9375C7.95528 24.9375 3.0625 20.0467 3.0625 14C3.0625 7.9573 7.9555 3.0625 14 3.0625C20.0425 3.0625 24.9375 7.95545 24.9375 14C24.9375 20.0446 20.0467 24.9375 14 24.9375ZM19.8649 10.9812C19.8649 14.6482 15.9044 14.7046 15.9044 16.0597V16.4062C15.9044 16.7687 15.6105 17.0625 15.2481 17.0625H12.7518C12.3894 17.0625 12.0956 16.7687 12.0956 16.4062V15.9327C12.0956 13.9779 13.5776 13.1965 14.6975 12.5686C15.6579 12.0302 16.2465 11.664 16.2465 10.951C16.2465 10.0078 15.0434 9.3818 14.0708 9.3818C12.8027 9.3818 12.2172 9.98211 11.3943 11.0207C11.1724 11.3007 10.7676 11.3527 10.4829 11.1369L8.96126 9.98309C8.68197 9.77134 8.61941 9.37792 8.81666 9.08824C10.1088 7.19091 11.7545 6.125 14.3169 6.125C17.0004 6.125 19.8649 8.21975 19.8649 10.9812ZM16.2969 20.125C16.2969 21.3915 15.2665 22.4219 14 22.4219C12.7335 22.4219 11.7031 21.3915 11.7031 20.125C11.7031 18.8585 12.7335 17.8281 14 17.8281C15.2665 17.8281 16.2969 18.8585 16.2969 20.125Z\",\n    fill: \"#BDCCD4\"\n  })));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgHelpIcon);\nexport default __webpack_public_path__ + \"static/media/HelpIcon.e78a43b1.svg\";\nexport { ForwardRef as ReactComponent };","var _path, _circle;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgNotificationActiveIcon(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 32,\n    height: 32,\n    viewBox: \"0 0 32 32\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M20.427 26C20.427 27.8937 18.8922 29.4286 17 29.4286C15.1079 29.4286 13.5731 27.8937 13.5731 26H20.427ZM28.3362 21.1939C28.4067 21.2681 28.4745 21.3393 28.5388 21.4084C28.8602 21.7534 29.0027 22.167 29 22.5714C28.9947 23.45 28.3047 24.2857 27.2804 24.2857H6.71968C5.69539 24.2857 5.00593 23.45 5.00004 22.5714C4.99736 22.167 5.13986 21.7539 5.46129 21.4084C5.52557 21.3393 5.59334 21.2681 5.6639 21.1939C6.72939 20.0737 8.43289 18.2828 8.43289 13.1429C8.43289 8.98036 11.3515 5.64821 15.2868 4.83071V3.71429C15.2868 2.76768 16.054 2 17 2C17.9461 2 18.7133 2.76768 18.7133 3.71429V4.83071C19.9854 5.09499 21.1513 5.62204 22.1468 6.35498C20.3032 7.09144 19.0007 8.89361 19.0007 11C19.0007 13.7614 21.2393 16 24.0007 16C24.6088 16 25.1915 15.8914 25.7306 15.6927C26.182 18.9292 27.4699 20.2832 28.3362 21.1939Z\",\n    fill: \"#BDCCD4\"\n  })), _circle || (_circle = /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 24,\n    cy: 11,\n    r: 3,\n    fill: \"#4FFFB0\"\n  })));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgNotificationActiveIcon);\nexport default __webpack_public_path__ + \"static/media/NotificationActiveIcon.c184ef16.svg\";\nexport { ForwardRef as ReactComponent };","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgNotificationInactiveIcon(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 28,\n    viewBox: \"0 0 24 28\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M12 27.4286C13.8922 27.4286 15.427 25.8937 15.427 24H8.57307C8.57307 25.8937 10.1079 27.4286 12 27.4286ZM23.5388 19.4084C22.5038 18.2963 20.5672 16.6232 20.5672 11.1429C20.5672 6.98036 17.6486 3.64821 13.7133 2.83071V1.71429C13.7133 0.767679 12.9461 0 12 0C11.054 0 10.2868 0.767679 10.2868 1.71429V2.83071C6.35147 3.64821 3.43289 6.98036 3.43289 11.1429C3.43289 16.6232 1.49629 18.2963 0.461287 19.4084C0.139858 19.7539 -0.00264153 20.167 3.70387e-05 20.5714C0.0059299 21.45 0.695394 22.2857 1.71968 22.2857H22.2804C23.3047 22.2857 23.9947 21.45 24 20.5714C24.0027 20.167 23.8602 19.7534 23.5388 19.4084Z\",\n    fill: \"#BDCCD4\"\n  })));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgNotificationInactiveIcon);\nexport default __webpack_public_path__ + \"static/media/NotificationInactiveIcon.71a03dbb.svg\";\nexport { ForwardRef as ReactComponent };","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgDropdownArrowIcon(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 10,\n    height: 8,\n    viewBox: \"0 0 10 8\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.46879 7.00939L0.218787 2.75938C-0.0749634 2.46563 -0.0749634 1.99063 0.218787 1.7L0.925036 0.99375C1.21879 0.7 1.69379 0.7 1.98441 0.99375L4.99691 4.00626L8.00941 0.99375C8.30316 0.7 8.77816 0.7 9.06879 0.99375L9.77503 1.7C10.0688 1.99375 10.0688 2.46875 9.77503 2.75938L5.52504 7.00939C5.23754 7.30314 4.76254 7.30314 4.46879 7.00939Z\",\n    fill: \"#BDCCD4\"\n  })));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgDropdownArrowIcon);\nexport default __webpack_public_path__ + \"static/media/DropdownArrowIcon.288e1cd4.svg\";\nexport { ForwardRef as ReactComponent };","import { ReactComponent as HelpIcon } from './svg/HelpIcon.svg';\nimport { ReactComponent as NotificationActiveIcon } from './svg/NotificationActiveIcon.svg';\nimport { ReactComponent as NotificationInactiveIcon } from './svg/NotificationInactiveIcon.svg';\nimport { ReactComponent as DropdownArrowIcon } from './svg/DropdownArrowIcon.svg';\n\nexport enum IconType {\n  HELP = 'HELP',\n  NOTIFICATION_ACTIVE = 'NOTIFICATION_ACTIVE',\n  NOTIFICATION_INACTIVE = 'NOTIFICATION_INACTIVE',\n  DROPDOWN_ARROW = 'DROPDOWN_ARROW',\n}\n\nexport interface IconsProps {\n  type: IconType;\n}\n\nexport const Icon = ({ type }: IconsProps) => {\n  switch (type) {\n    case IconType.HELP:\n      return <HelpIcon />;\n    case IconType.NOTIFICATION_ACTIVE:\n      return <NotificationActiveIcon />;\n    case IconType.NOTIFICATION_INACTIVE:\n      return <NotificationInactiveIcon />;\n    case IconType.DROPDOWN_ARROW:\n      return <DropdownArrowIcon />;\n  }\n};\n","import { Account } from '../../../../generated/graphql';\nimport classNames from 'classnames';\nimport { FormattedBalance } from '../../../Balance/FormattedBalance/FormattedBalance';\nimport { UnitStyle } from '../../../Balance/metricUnit';\nimport './AccountItem.scss';\n\nimport Identicon from '@polkadot/react-identicon';\nexport interface AccountItemProps {\n  account: Account;\n  onClick: () => void;\n  active: boolean;\n}\n\nexport const AccountItem = ({ account, onClick, active }: AccountItemProps) => (\n  <div\n    className={\n      'account-item ' +\n      classNames({\n        'account-item--active': active,\n      })\n    }\n    onClick={onClick}\n  >\n    <div className=\"d-flex flex-align-space\">\n      <div className=\"account-item__heading\">{account.name}</div>\n      <div>\n        <FormattedBalance\n          balance={account?.balances[0]}\n          unitStyle={UnitStyle.SHORT}\n          precision={1}\n        />\n      </div>\n    </div>\n    <div className=\"d-flex flex-column\">\n      <div className=\"d-flex gap-2 my-1\">\n        <Identicon value={account?.id} size={32} />\n        <div className=\"d-flex flex-column\">\n          <div className=\"account-item__chain-name\">Basilisk</div>\n          <div className=\"account-item__chain-address\">{account?.id}</div>\n        </div>\n      </div>\n      <div className=\"d-flex gap-2 my-1\">\n        <Identicon value={account?.id} size={32} theme=\"polkadot\" />\n        <div className=\"d-flex flex-column\">\n          <div className=\"account-item__chain-name\">Kusama</div>\n          <div className=\"account-item__chain-address\">{account?.id}</div>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n","import classNames from 'classnames';\nimport './Button.scss';\n\nexport enum ButtonKind {\n  Primary = 'Primary',\n  Secondary = 'Secondary',\n}\n\nexport interface ButtonProps {\n  children: string;\n  kind?: ButtonKind;\n  onClick?: () => void;\n}\n\nexport const Button = ({\n  // TODO: default should not be primary\n  kind = ButtonKind.Primary,\n  children,\n}: ButtonProps) => {\n  return (\n    <button\n      className={\n        'button ' +\n        classNames({\n          'button--primary': kind === ButtonKind.Primary,\n        }) +\n        classNames({\n          'button--secondary': kind === ButtonKind.Secondary,\n        })\n      }\n    >\n      {children}\n    </button>\n  );\n};\n","import { MutableRefObject, useMemo } from 'react';\nimport { Account } from '../../../generated/graphql';\nimport { AccountItem } from './AccountItem/AccountItem';\nimport { Button, ButtonKind } from '../../Button/Button';\nimport './AccountSelector.scss';\n\nexport interface AccountSelectorProps {\n  accounts?: Account[];\n  account?: Account;\n  onAccountSelected: (asset: Account) => void;\n  innerRef: MutableRefObject<HTMLDivElement | null>;\n  closeModal: () => void;\n}\n\n/**\n * Renders a list of accounts that the user can select an account from\n */\nexport const AccountSelector = ({\n  accounts,\n  onAccountSelected,\n  account,\n  innerRef,\n  closeModal,\n}: AccountSelectorProps) => {\n  const activeAccount = useMemo(() => account, [account]);\n\n  return (\n    <div className=\"account-selector\" ref={innerRef}>\n      <div className=\"account-selector__content-wrapper\">\n        <div className=\"account-selector__heading d-flex flex-align-space mx-3 my-3\">\n          <div>Select an account</div>\n          <div\n            className=\"account-selector__close-modal-btn\"\n            onClick={() => closeModal()}\n          >\n            x\n          </div>\n        </div>\n        {accounts?.length ? (\n          <div className=\"account-selector__accounts-list\">\n            {accounts?.map((account, i) => (\n              <AccountItem\n                key={i}\n                onClick={() => onAccountSelected(account)}\n                active={account.id === activeAccount?.id}\n                account={account}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"mx-3 my-5 text-center\">\n            <h4>No accounts available</h4>\n            <a href=\"/#\" className=\"account-selector__create-account-link\">\n              Need help creating an account? <br />\n              Click here\n            </a>\n          </div>\n        )}\n        {account && (\n          <div className=\"d-flex mx-3\">\n            <Button kind={ButtonKind.Secondary}>Clear account</Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","import { MutableRefObject, useCallback } from 'react';\nimport { FormattedBalance } from '../Balance/FormattedBalance/FormattedBalance';\nimport { Account } from '../../generated/graphql';\nimport { UnitStyle } from '../Balance/metricUnit';\nimport { Icon, IconType } from '../Icon/Icon';\nimport Identicon from '@polkadot/react-identicon';\nimport './Wallet.scss';\nimport { useModalPortal } from '../Balance/AssetBalanceInput/hooks/useModalPortal';\nimport { useModalPortalElement } from './AccountSelector/hooks/useModalPortalElement';\n\nconst horizontalBar = '';\n\nexport interface WalletProps {\n  modalContainerRef: MutableRefObject<HTMLDivElement | null>;\n  accounts?: Account[];\n  account?: Account;\n  onAccountSelected: (account: Account) => void;\n}\n\nexport const Wallet = ({\n  modalContainerRef,\n  accounts,\n  account,\n  onAccountSelected,\n}: WalletProps) => {\n  const modalPortalElement = useModalPortalElement({\n    accounts,\n    onAccountSelected,\n    account,\n  });\n  const { toggleModal, modalPortal, toggleId } = useModalPortal(\n    modalPortalElement,\n    modalContainerRef,\n    false // don't auto close when clicking outside the modalPortalElement\n  );\n  const handleAccountSelectorClick = useCallback(\n    () => toggleModal(),\n    [toggleModal]\n  );\n\n  return (\n    <div className=\"wallet d-flex justify-content-between\">\n      {/* This portal will be rendered at it's container ref as defined above */}\n      {modalPortal}\n\n      <div className=\"wallet__icons-wrapper\">\n        <span className=\"wallet__icon\">\n          <Icon type={IconType.HELP} />\n        </span>\n        <span className=\"wallet__icon\">\n          <Icon type={IconType.NOTIFICATION_INACTIVE} />\n        </span>\n      </div>\n      <div\n        className=\"d-flex wallet__info-wrapper\"\n        onClick={(_) => handleAccountSelectorClick()}\n        data-modal-portal-toggle={toggleId}\n      >\n        {account ? (\n          <>\n            <div className=\"d-flex flex-column align-items-end\">\n              {account?.balances[0] ? (\n                <FormattedBalance\n                  balance={account?.balances[0]}\n                  unitStyle={UnitStyle.SHORT}\n                  precision={1}\n                />\n              ) : (\n                <div>{horizontalBar}</div>\n              )}\n              <div className=\"wallet__fiat-balance\">~$ {horizontalBar}</div>\n            </div>\n            <Identicon value={account?.id} size={32} />\n            <div className=\"wallet__account-name\">{account?.name}</div>\n          </>\n        ) : (\n          <>\n            <div className=\"wallet__select-account-icon\" />\n            <div className=\"wallet__connect-account-action\">\n              Connect account\n            </div>\n          </>\n        )}\n        <div>\n          <Icon type={IconType.DROPDOWN_ARROW} />\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { useCallback } from 'react';\nimport { Account } from '../../../../generated/graphql';\nimport { AccountSelector } from './../AccountSelector';\nimport {\n  ModalPortalElementFactory,\n  ModalPortalElementFactoryArgs,\n} from './../../../Balance/AssetBalanceInput/hooks/useModalPortal';\nimport { WalletProps } from '../../Wallet';\n\nexport type ModalPortalElement = ({\n  accounts,\n  onAccountSelected,\n  account,\n}: Pick<\n  WalletProps,\n  'accounts' | 'onAccountSelected' | 'account'\n>) => ModalPortalElementFactory;\nexport type CloseModal = ModalPortalElementFactoryArgs['closeModal'];\n\nexport const useModalPortalElement: ModalPortalElement = ({\n  accounts,\n  onAccountSelected,\n  account,\n}) => {\n  const handleAccountSelected = useCallback(\n    (closeModal: CloseModal) => (account: Account) => {\n      closeModal();\n      onAccountSelected(account);\n    },\n    [onAccountSelected]\n  );\n\n  return useCallback(\n    ({ closeModal, elementRef, isModalOpen }) => {\n      return isModalOpen ? (\n        <AccountSelector\n          innerRef={elementRef}\n          accounts={accounts}\n          account={account}\n          onAccountSelected={handleAccountSelected(closeModal)}\n          closeModal={closeModal}\n        />\n      ) : (\n        <></>\n      );\n    },\n    [accounts, account, handleAccountSelected]\n  );\n};\n","import { MutableRefObject, ReactNode, ReactPortal, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useOnClickOutside } from 'use-hooks';\nimport { v4 as uuidv4 } from 'uuid';\nexport interface ModalPortalElementFactoryArgs {\n    openModal: () => void,\n    closeModal: () => void,\n    toggleModal: () => void,\n    elementRef: MutableRefObject<HTMLDivElement | null>,\n    isModalOpen: boolean,\n}\n\nexport type ModalPortalElementFactory = (args: ModalPortalElementFactoryArgs) => ReactNode;\n\nexport const useModalPortal = (\n    elementFactory: ModalPortalElementFactory,\n    container: MutableRefObject<HTMLDivElement | null>,\n    closeOnClickOutside: boolean = true,\n) => {\n    const [modalPortal, setModalPortal] = useState<ReactPortal | undefined>();\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    \n    const toggleModal = useCallback(() => setIsModalOpen(isModalOpen => !isModalOpen), [setIsModalOpen]);\n    const openModal = useCallback(() => setIsModalOpen(true), [setIsModalOpen]);\n    const closeModal = useCallback(() => setIsModalOpen(false), [setIsModalOpen]);\n\n    const elementRef = useRef<HTMLDivElement | null>(null);\n\n    const toggleId = useMemo(() => uuidv4(), []);\n\n    const element = useMemo(() => {\n        return elementFactory({ toggleModal, openModal, closeModal, elementRef, isModalOpen })\n    }, [elementFactory, toggleModal, openModal, closeModal, isModalOpen, elementRef]);\n\n    useEffect(() => {\n        if (!container.current || !element) return;\n        setModalPortal(\n            createPortal(element, container.current)\n        );\n    }, [container.current, element]);\n    \n    useOnClickOutside(elementRef as MutableRefObject<Node>, (event) => {\n        const didClickOutsideToggle = !(event.target as HTMLElement).closest(`[data-modal-portal-toggle=\"${toggleId}\"]`);\n        closeOnClickOutside && didClickOutsideToggle && closeModal()\n    });\n\n    return { \n        toggleModal,\n        openModal,\n        closeModal,\n        isModalOpen,\n        toggleId,\n        modalPortal: modalPortal\n    };\n}","import { Wallet as WalletComponent } from '../components/Wallet/Wallet';\nimport { useGetExtensionQuery } from '../hooks/polkadotJs/useGetExtensionQuery';\nimport { useRef } from 'react';\nimport { useGetAccountsQuery } from '../hooks/accounts/queries/useGetAccountsQuery';\n\nexport const Wallet = () => {\n  const { data: extensionData, loading: extensionLoading } =\n    useGetExtensionQuery();\n  const { data: accountsData, loading: accountsLoading } =\n    useGetAccountsQuery();\n\n  const modalContainerRef = useRef<HTMLDivElement | null>(null);\n\n  console.log(extensionData, extensionLoading, accountsLoading);\n\n  // request data from the data layer\n  // render the component with the provided data\n  return (\n    <>\n      <div ref={modalContainerRef} />\n      <WalletComponent\n        accounts={accountsData?.accounts}\n        onAccountSelected={(account) => console.log(account)}\n        modalContainerRef={modalContainerRef}\n      />\n    </>\n  );\n};\n","import { first } from 'lodash';\nimport { useMemo } from 'react';\nimport { ActionBar } from '../components/Navigation/ActionBar';\nimport { Navigation } from '../components/Navigation/Navigation';\nimport { useGetActiveAccountQuery } from '../hooks/accounts/queries/useGetActiveAccountQuery';\nimport { nativeAssetId } from '../hooks/balances/useGetBalancesByAddress';\nimport { useLastBlockQuery } from '../hooks/lastBlock/useLastBlockQuery';\nimport { useGetExtensionQuery } from '../hooks/polkadotJs/useGetExtensionQuery';\n\nimport './TopBar.scss';\nimport { Wallet } from './Wallet';\n\nexport const TopBar = () => {\n  // TODO: there is no loading state for last block\n  // since its populated in the cache manually\n  const { data: lastBlockData } = useLastBlockQuery();\n  const {\n    data: activeAccountData,\n    loading: activeAccountLoading,\n    error,\n  } = useGetActiveAccountQuery();\n  const { data: extensionData, loading: extensionLoading } =\n    useGetExtensionQuery();\n\n  error && console.error(error);\n\n  // TODO: should probably be showing the fee payment asset here\n  const nativeAssetBalance = useMemo(\n    () =>\n      first(\n        activeAccountData?.account?.balances?.filter(\n          (balance) => balance.assetId === nativeAssetId\n        )\n      )?.balance,\n    [activeAccountData]\n  );\n\n  return (\n    <div className=\"top-bar\">\n      <Navigation />\n\n      <div>\n        <b>Last block: </b>\n        {lastBlockData?.lastBlock?.parachainBlockNumber\n          ? `#${lastBlockData?.lastBlock?.parachainBlockNumber} / #${lastBlockData?.lastBlock?.relaychainBlockNumber}`\n          : 'loading...'}\n      </div>\n\n      <ActionBar\n        {...{\n          isExtensionAvailable:\n            !!extensionData && !!extensionData.extension?.isAvailable,\n          extensionLoading,\n          activeAccountLoading,\n          accountData: activeAccountData\n            ? {\n                name: activeAccountData.account\n                  ? activeAccountData.account.name\n                    ? activeAccountData.account.name\n                    : undefined\n                  : undefined,\n                nativeAssetBalance,\n                address: 'placeholder fill me',\n              }\n            : undefined,\n        }}\n      />\n\n      <Wallet />\n    </div>\n  );\n};\n","import React from 'react'\nimport { useLoading } from '../hooks/misc/useLoading'\nimport { TopBar } from './TopBar'\n\nexport const PageContainer = ({ children }: { children: React.ReactNode }) => {\n    const loading = useLoading();\n    return (\n        <div style={{\n            padding: '24px',\n            margin: '0 auto'\n        }}>\n            <TopBar />\n            {loading\n                ? <div style={{\n                    width: '100%',\n                    textAlign: 'center',\n                }}>\n                    <i>Connecting to the node...</i>\n                </div>\n                : children\n            }\n        </div>\n    )\n}","import { useMathContext } from '../math/useMath';\nimport { usePolkadotJsContext } from '../polkadotJs/usePolkadotJs'\n\nexport const useLoading = () => {\n    const { apiInstance } = usePolkadotJsContext();\n    const { math } = useMathContext();\n    return !apiInstance || !math;\n}","import './App.scss';\nimport { MultiProvider } from './containers/MultiProvider';\nimport log from 'loglevel';\nimport { BrowserRouter } from 'react-router-dom';\nimport { Router } from './containers/Router';\nimport { PageContainer } from './containers/PageContainer';\n\nlog.setLevel('debug');\n\nexport const branch = process.env.REACT_APP_GIT_BRANCH;\nexport const baseName = branch?.length ? `basilisk-ui/${branch}/app` : undefined;\n\nexport const App = () => {\n  return (\n    <MultiProvider>\n      <BrowserRouter basename={baseName}>\n        <PageContainer>\n          <Router />\n        </PageContainer>\n      </BrowserRouter>\n    </MultiProvider>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport './index.scss';\n\nReactDOM.render(\n  // TODO: figure out a way to enable react strict mode\n  // without triggering duplicate graphql queries\n  // https://github.com/apollographql/react-apollo/issues/3906#issuecomment-636604835\n  // <React.StrictMode>\n    <App/>,\n  // </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}